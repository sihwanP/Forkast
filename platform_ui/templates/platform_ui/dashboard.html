{% extends 'platform_ui/base.html' %}
{% load static humanize %}

{% block title %}í¬ì¹´ìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block content %}
    <!-- 2. Hero Section -->
    <section class="section relative overflow-hidden flex items-end pb-20 min-h-screen">
        <!-- Main Video -->
        <video class="hero-video absolute top-0 left-0 w-full h-full object-cover z-[-1]" autoplay muted loop playsinline>
            <source src="{% static 'videos/hero.mp4' %}" type="video/mp4">
            <div class="bg-gray-900 w-full h-full"></div>
        </video>
        <!-- Cinematic Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/60 to-transparent z-0"></div>

        <div class="relative z-10 max-w-7xl mx-auto w-full px-6 flex flex-col lg:flex-row items-end gap-12 animate-fade-in-up">

            <!-- Left: Main Title -->
            <div class="flex-1 text-left lg:mb-4">
                <span class="inline-block py-1 px-3 rounded-full bg-blue-500/20 text-blue-400 text-sm font-bold mb-4 border border-blue-500/30">í¬ì¹´ìŠ¤íŠ¸ AI ì†”ë£¨ì…˜</span>
                <h1 class="text-5xl lg:text-7xl font-bold mb-6 text-white drop-shadow-lg leading-[1.6]">
                    AI ê¸°ë°˜<br>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-green-400">ë°ì¼ë¦¬ ë§¤ì¶œ ì˜ˆì¸¡</span>
                </h1>
                <p class="text-lg text-gray-300 max-w-lg drop-shadow-md">
                    ë‹¹ì‹ ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ì—¬,<br>ì˜¤ëŠ˜ì˜ ì„±ê³µ ì „ëµê³¼ ë”°ëœ»í•œ ê°ì„± ì¼€ì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                </p>
            </div>

            <!-- Right: Real-time Data Cards -->
            <div class="w-full lg:w-auto flex-none">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Revenue -->
                    <a href="{% url 'sales_dashboard' %}" class="block glass p-5 rounded-xl border-l-4 border-blue-500 hover:bg-white/5 transition cursor-pointer relative z-[100] hover:scale-105">
                        <h3 class="text-gray-400 text-xs uppercase font-bold tracking-wider mb-1">ì˜¤ëŠ˜ ì˜ˆìƒ ë§¤ì¶œ (AI)</h3>
                        <p id="prediction-value" class="text-2xl font-bold text-white">
                            {% if prediction_display %}â‚© {{ prediction_display|intcomma }}{% else %}<span class="animate-pulse">ë¶„ì„ì¤‘...</span>{% endif %}
                        </p>
                        <div id="prediction-status" class="mt-2 text-xs text-blue-300 flex items-center gap-1"><span>ğŸ“ˆ</span> <span>ì‹¤ì‹œê°„ ë¶„ì„ ì¤‘</span></div>
                    </a>
                    <!-- Weather -->
                    <div class="glass p-5 rounded-xl border-l-4 border-yellow-500">
                        <h3 class="text-gray-400 text-xs uppercase font-bold tracking-wider mb-1">í˜„ì¬ ë‚ ì”¨ ì„íŒ©íŠ¸</h3>
                        <p id="weather-cond" class="text-2xl font-bold text-white">{% if weather_obj %}{{ weather_obj.condition }}{% else %}<span class="animate-pulse">--</span>{% endif %}</p>
                        <div class="mt-2 text-xs text-yellow-300 flex items-center gap-1"><span>ğŸŒ¡ï¸</span> <span id="weather-temp">{% if weather_obj %}{{ weather_obj.temperature }}Â°{% else %}--{% endif %}</span></div>
                    </div>
                    <!-- Inventory -->
                    <a href="{% url 'inventory' %}" class="block glass p-5 rounded-xl border-l-4 border-green-500 hover:bg-white/5 transition cursor-pointer relative z-10">
                        <h3 class="text-gray-400 text-xs uppercase font-bold tracking-wider mb-1">ì¬ê³  ìƒíƒœ</h3>
                        <p class="text-2xl font-bold text-white">{% if "ë¶€ì¡±" in inventory_ctx %}ì£¼ì˜{% else %}ì•ˆì •ì {% endif %}</p>
                        <div class="mt-2 text-xs text-green-300 truncate max-w-[140px]">{{ inventory_ctx|default:"ë°ì´í„° ì—†ìŒ" }}</div>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- 3. Service Explanation Video -->
    <section class="section py-20 bg-gray-800">
        <div class="max-w-7xl mx-auto w-full flex flex-col md:flex-row items-center gap-16 px-6">
            <div class="w-full md:w-1/2">
                <div data-src="{% static 'videos/service.mp4' %}" onclick="openVideoModal(this.dataset.src)"
                    class="aspect-video bg-gray-700 rounded-xl overflow-hidden shadow-2xl flex items-center justify-center relative group cursor-pointer hover:ring-4 ring-blue-500/50 transition">
                    <video class="w-full h-full object-cover pointer-events-none">
                        <source src="{% static 'videos/service.mp4' %}" type="video/mp4">
                    </video>
                    <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 flex items-center justify-center transition">
                        <div class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center group-hover:scale-110 transition border border-white/30">
                            <span class="text-4xl text-white ml-2">â–¶</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-full md:w-1/2 text-left">
                <h2 class="text-4xl lg:text-5xl font-bold mb-8 leading-[2.0]">AIê°€ ë¶„ì„í•˜ëŠ”<br>ì´ˆê°œì¸í™” ë¹„ì¦ˆë‹ˆìŠ¤ ì „ëµ</h2>
                <p class="text-lg lg:text-xl text-gray-300">Forkastì˜ AIëŠ” ë‹¨ìˆœí•œ í†µê³„ê°€ ì•„ë‹™ë‹ˆë‹¤. ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”í•˜ëŠ” ì‹œì¥ ìƒí™©ì„ ì½ê³ , ë‹¹ì‹ ì˜ ë§¤ì¥ì— ë”± ë§ëŠ” ì „ëµì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>

    <!-- 4. Promo Video -->
    <section class="section py-20 bg-gray-900">
        <div class="max-w-7xl mx-auto w-full text-center px-6">
            <h2 class="text-4xl font-bold mb-12">ì„±ê³µí•˜ëŠ” ì‚¬ì¥ë‹˜ë“¤ì˜ ë¹„ë°€</h2>
            <div data-src="{% static 'videos/promo.mp4' %}" onclick="openVideoModal(this.dataset.src)"
                class="aspect-video bg-gray-800 rounded-xl overflow-hidden shadow-2xl mx-auto max-w-5xl flex items-center justify-center relative cursor-pointer group hover:ring-4 ring-blue-500/50 transition">
                <video class="w-full h-full object-cover pointer-events-none">
                    <source src="{% static 'videos/promo.mp4' %}" type="video/mp4">
                </video>
                <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 flex items-center justify-center transition">
                    <div class="w-24 h-24 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center group-hover:scale-110 transition border border-white/30">
                        <span class="text-5xl text-white ml-2">â–¶</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. AI Sales Analysis -->
    <section class="section py-20 bg-gray-800">
        <div class="max-w-7xl mx-auto w-full px-6">
            <h2 class="text-4xl font-bold mb-12 text-center">ì‹¤ì‹œê°„ ë§¤ì¶œ ë¶„ì„ ë° íë¦„ ì˜ˆì¸¡</h2>
            
            <div class="mb-8 flex justify-between items-end border-b border-gray-700 pb-4">
                <div>
                    <h3 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300">ì˜¤ëŠ˜ ì‹¤ì‹œê°„ ë¶„ì„</h3>
                    <p class="text-gray-400 mt-1 text-sm">ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ AI ë§¤ì¶œ í†µì°°ë ¥</p>
                </div>
                <div class="flex items-center gap-3">
                    <input type="file" id="csvUploadInput" accept=".csv" class="hidden" onchange="uploadCSV(this)">
                    <button onclick="document.getElementById('csvUploadInput').click()" 
                        class="group relative px-6 py-3 rounded-xl bg-blue-600 hover:bg-blue-500 transition-all shadow-lg hover:shadow-blue-500/30 overflow-hidden">
                        <div class="absolute inset-0 bg-white/20 group-hover:translate-x-full transition-transform duration-500 ease-out -translate-x-full skew-x-12"></div>
                        <span class="relative font-bold text-white flex items-center gap-2"><span>ğŸ“‚</span> ë°ì´í„° ì—…ë¡œë“œ</span>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                <!-- Chart Area -->
                <div class="glass p-1 rounded-2xl bg-gradient-to-br from-white/10 to-transparent relative shadow-2xl">
                    <div class="bg-gray-900/80 backdrop-blur-xl rounded-xl p-6 h-96 flex flex-col relative text-center">
                        <div id="salesChartContainer" class="w-full h-full"></div>
                        <div id="chart-overlay-msg" class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-opacity">
                            <span class="text-white/20 text-4xl font-bold">ë°ì´í„° ìˆ˜ì‹  ëŒ€ê¸°ì¤‘...</span>
                        </div>
                    </div>
                </div>

                <!-- Analysis Dashboard -->
                <div class="flex flex-col gap-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="glass bg-gray-800/50 p-5 rounded-2xl border border-white/5 relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-3 opacity-20 group-hover:scale-110 transition-transform text-4xl">ğŸ’°</div>
                            <h4 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">ì´ ë§¤ì¶œ</h4>
                            <p class="text-3xl font-black text-white" id="stat-total-revenue">-</p>
                        </div>
                        <div class="glass bg-gray-800/50 p-5 rounded-2xl border border-white/5 relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-3 opacity-20 group-hover:scale-110 transition-transform text-4xl">â±ï¸</div>
                            <h4 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">ì´ ì£¼ë¬¸</h4>
                            <p class="text-3xl font-black text-white" id="stat-total-orders">-</p>
                        </div>
                    </div>

                    <div class="glass p-6 rounded-2xl border border-blue-500/30 bg-gradient-to-b from-blue-900/20 to-gray-900/50 relative shadow-lg">
                        <h3 class="flex items-center gap-2 font-bold text-xl text-blue-300 mb-4"><span class="animate-pulse">ğŸ¤–</span> AI ë¶„ì„ ë¦¬í¬íŠ¸</h3>
                        <p id="ai-analysis-text" class="text-gray-300 text-base font-light">
                            {% if ai_sales_analysis %}{{ ai_sales_analysis|linebreaksbr }}{% else %}<span class="text-gray-500 italic">ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ë©´ AIê°€ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...</span>{% endif %}
                        </p>
                    </div>

                    <div class="relative group">
                        <div class="absolute -inset-1 bg-gradient-to-r from-amber-400 to-orange-600 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                        <div class="relative bg-gray-900/80 backdrop-blur-xl p-6 rounded-2xl border border-amber-500/30 flex items-start gap-5">
                            <div class="bg-amber-500/20 p-3 rounded-full shrink-0"><span class="text-3xl">ğŸ’Œ</span></div>
                            <div class="flex-1">
                                <h4 class="text-xs font-bold text-amber-400 uppercase mb-2 tracking-widest flex items-center gap-2">ì˜¤ëŠ˜ì˜ íë§ ë©”ì‹œì§€ <span class="h-px flex-1 bg-amber-500/30"></span></h4>
                                <p id="center-cheer-msg" class="text-amber-100/90 italic text-lg font-serif">
                                    <span class="text-sm text-gray-400 not-italic font-sans">AIê°€ ë”°ëœ»í•œ ìœ„ë¡œë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="text-2xl font-bold mb-6 text-left border-l-4 border-purple-500 pl-4 flex justify-between items-center">
                <span>ê³¼ê±° ë§¤ì¶œ ë° íë¦„ ë¶„ì„</span>
                <div class="flex items-center gap-2">
                    <input type="file" id="pastCsvUploadInput" accept=".csv" class="hidden" onchange="uploadPastCSV(this)">
                    <button onclick="document.getElementById('pastCsvUploadInput').click()" class="text-sm bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-lg transition flex items-center gap-2"><span>ğŸ“‚</span> ê³¼ê±° ë°ì´í„° ì—…ë¡œë“œ</button>
                </div>
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="glass p-8 rounded-xl h-96 flex items-center justify-center bg-gray-900/50 relative">
                    <div id="pastSalesChart" class="w-full h-full"></div>
                </div>
                <div class="space-y-6">
                    <div class="glass p-8 rounded-xl border-l-4 border-purple-500">
                        <h3 class="font-bold text-2xl mb-4">ğŸ“‰ AI ê³¼ê±° ë¶„ì„</h3>
                        <p id="past-analysis-text" class="text-gray-300 text-lg"><span class="animate-pulse">ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 6. Decision Making Infographic -->
    <section class="section py-20 bg-gray-800">
        <h2 class="text-4xl font-bold mb-12 text-center">ì˜ì‚¬ê²°ì • ëŒ€ì‹œë³´ë“œ</h2>
        <div class="max-w-7xl mx-auto w-full glass p-12 rounded-2xl px-6">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8">
                <div>
                    <h3 class="text-2xl font-bold">ì˜¤ëŠ˜ì˜ AI ì¶”ì²œ ì•¡ì…˜</h3>
                    <p class="text-gray-400">ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ê°€ì¥ í™•ë¥  ë†’ì€ ì„±ê³µ ì „ëµì„ ì„ íƒí•˜ì„¸ìš”.</p>
                </div>
                <div class="text-right">
                    <span class="text-sm text-gray-400">ì‹ ë¢°ë„</span>
                    <div class="text-3xl font-bold text-green-400">92%</div>
                </div>
            </div>
            
            <div class="flex gap-4 items-center justify-center h-64 bg-gray-900/50 rounded-xl mb-8">
                <div id="decision-sales" onclick="selectDecision('sales')" class="text-center p-4 cursor-pointer transition transform hover:scale-105 opacity-100">
                    <div class="w-32 h-32 rounded-full border-8 border-blue-500 flex items-center justify-center text-xl font-bold mb-2 transition-all shadow-[0_0_20px_rgba(59,130,246,0.2)]">ë§¤ì¶œ</div>
                    <span class="text-gray-400 text-sm font-bold">ëª©í‘œ ë‹¬ì„± ìœ ë ¥</span>
                </div>
                <div id="decision-profit" onclick="selectDecision('profit')" class="text-center p-4 cursor-pointer transition transform hover:scale-105 opacity-100">
                    <div class="w-32 h-32 rounded-full border-8 border-yellow-500 flex items-center justify-center text-xl font-bold mb-2 transition-all shadow-[0_0_20px_rgba(234,179,8,0.2)]">ì´ìµ</div>
                    <span class="text-gray-400 text-sm font-bold">ë§ˆì§„ìœ¨ 25% ì˜ˆìƒ</span>
                </div>
                <div id="decision-customer" onclick="selectDecision('customer')" class="text-center p-4 cursor-pointer transition transform hover:scale-105 opacity-100">
                    <div class="w-32 h-32 rounded-full border-8 border-green-500 flex items-center justify-center text-xl font-bold mb-2 transition-all shadow-[0_0_20px_rgba(34,197,94,0.2)]">ê³ ê°</div>
                    <span class="text-gray-400 text-sm font-bold">ë§Œì¡±ë„ ìµœìƒ</span>
                </div>
            </div>

            <div class="flex justify-between items-center gap-4">
                <button onclick="openAppliedModal()" class="bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded-lg font-bold transition flex items-center gap-2 border border-gray-600"><span>ğŸ“‹</span> ì ìš©ì‚¬í•­</button>
                <div class="flex gap-4">
                    <button class="bg-gray-600 hover:bg-gray-500 px-6 py-3 rounded-lg font-bold">ë³´ë¥˜</button>
                    <button onclick="executeStrategy()" id="btn-execute-strategy" class="bg-blue-600 hover:bg-blue-500 px-6 py-3 rounded-lg font-bold transition flex items-center gap-2"><span>ğŸš€</span> ì „ëµ ìŠ¹ì¸ ë° ì‹¤í–‰</button>
                </div>
            </div>
        </div>
    </section>

    <!-- 9. Strategy Section -->
    <section class="section py-20 bg-slate-800/50">
        <h2 class="text-4xl font-bold mb-12 text-center text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">ìµœì  ìš´ì˜ ì „ëµ ì œì•ˆ (AI)</h2>
        <div id="strategy-container" class="max-w-6xl mx-auto w-full px-6 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass p-8 rounded-2xl animate-pulse">
                <div class="h-12 w-12 bg-gray-700 rounded-full mb-6"></div>
                <div class="h-6 w-3/4 bg-gray-700 rounded mb-3"></div>
                <div class="h-4 w-full bg-gray-700 rounded mb-6"></div>
            </div>
             <div class="glass p-8 rounded-2xl animate-pulse">
                <div class="h-12 w-12 bg-gray-700 rounded-full mb-6"></div>
                <div class="h-6 w-3/4 bg-gray-700 rounded mb-3"></div>
                <div class="h-4 w-full bg-gray-700 rounded mb-6"></div>
            </div>
             <div class="glass p-8 rounded-2xl animate-pulse">
                <div class="h-12 w-12 bg-gray-700 rounded-full mb-6"></div>
                <div class="h-6 w-3/4 bg-gray-700 rounded mb-3"></div>
                <div class="h-4 w-full bg-gray-700 rounded mb-6"></div>
            </div>
        </div>
    </section>

    <!-- Footer (Dashboard Only) -->
    <footer class="mt-20 border-t border-slate-700/50 bg-slate-900/50 backdrop-blur-sm py-12 px-6 lg:px-12">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
            <!-- Brand -->
            <div class="md:col-span-2">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500">í¬ì¹´ìŠ¤íŠ¸ AI (Forkast AI)</span>
                </div>
                <p class="text-gray-400 mb-4 max-w-sm">
                    AI ê¸°ë°˜ ë°ì¼ë¦¬ ë§¤ì¶œ ì˜ˆì¸¡ ë° ë§¤ì¥ ê´€ë¦¬ ì†”ë£¨ì…˜.<br>
                    ë°ì´í„°ë¡œ ì¦ëª…í•˜ëŠ” ì„±ê³µ, í¬ì¹´ìŠ¤íŠ¸ì™€ í•¨ê»˜í•˜ì„¸ìš”.
                </p>
                <div class="flex gap-4">
                    <a href="#" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-gray-400 hover:bg-blue-600 hover:text-white transition">ğŸ¦</a>
                    <a href="#" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-gray-400 hover:bg-blue-600 hover:text-white transition">ğŸ“˜</a>
                    <a href="#" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-gray-400 hover:bg-blue-600 hover:text-white transition">ğŸ“¸</a>
                </div>
            </div>

            <!-- Links 1 -->
            <div>
                <h4 class="font-bold text-white mb-4">ì„œë¹„ìŠ¤</h4>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="{% url 'sales_dashboard' %}" class="hover:text-blue-400 transition">ë§¤ì¶œ ë¶„ì„</a></li>
                    <li><a href="{% url 'analytics_forecast' %}" class="hover:text-blue-400 transition">AI ì˜ˆì¸¡</a></li>
                    <li><a href="{% url 'analytics_menu' %}" class="hover:text-blue-400 transition">ë©”ë‰´ ì¸ì‚¬ì´íŠ¸</a></li>
                    <li><a href="{% url 'settings' %}" class="hover:text-blue-400 transition">ìš”ê¸ˆì œ ì•ˆë‚´</a></li>
                </ul>
            </div>

            <!-- Links 2 -->
            <div>
                <h4 class="font-bold text-white mb-4">ê³ ê° ì§€ì›</h4>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-blue-400 transition">ê³µì§€ì‚¬í•­</a></li>
                    <li><a href="#" class="hover:text-blue-400 transition">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</a></li>
                    <li><a href="#" class="hover:text-blue-400 transition">1:1 ë¬¸ì˜í•˜ê¸°</a></li>
                    <li><a href="#" class="hover:text-blue-400 transition">API ë¬¸ì„œ</a></li>
                </ul>
            </div>
        </div>

        <div class="max-w-7xl mx-auto border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-500">
            <div class="text-center md:text-left">
                <p class="mb-2">
                    (ì£¼)í¬ì¹´ìŠ¤íŠ¸ | ëŒ€í‘œì´ì‚¬: ê¹€í™˜í¬ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 123-45-67890<br>
                    ì£¼ì†Œ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 427 ìœ„ì›Œí¬íƒ€ì›Œ 3ì¸µ | í†µì‹ íŒë§¤ì—…ì‹ ê³ : 2026-ì„œìš¸ê°•ë‚¨-00123
                </p>
                <p>Copyright Â© 2026 Forkast Corp. All rights reserved.</p>
            </div>
            <div class="flex gap-6">
                <a href="#" class="hover:text-white transition">ì´ìš©ì•½ê´€</a>
                <a href="#" class="hover:text-white transition font-bold">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                <a href="#" class="hover:text-white transition">ìš´ì˜ì •ì±…</a>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div id="modal-container"></div>
    <div id="applied-modal" class="fixed inset-0 z-[200] hidden items-center justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAppliedModal()"></div>
        <div class="relative glass bg-gray-900 border border-gray-700 p-8 rounded-2xl max-w-2xl w-full mx-4 shadow-2xl transform transition-all scale-95 opacity-0 modal-content">
            <button onclick="closeAppliedModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button>
            <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“‹</span> í˜„ì¬ ì ìš©ëœ ì „ëµ ëª©ë¡</h3>
            <div class="bg-gray-800/50 rounded-xl p-6 min-h-[200px] max-h-[400px] overflow-y-auto custom-scrollbar">
                <ul id="applied-list" class="space-y-4"><li class="text-gray-500 text-center py-8">ì•„ì§ ì ìš©ëœ ì „ëµì´ ì—†ìŠµë‹ˆë‹¤.</li></ul>
            </div>
            <div class="flex justify-end mt-6 gap-3">
                <button onclick="undoLastStrategy()" class="px-6 py-3 bg-red-600/80 hover:bg-red-500 rounded-lg text-white font-bold transition flex items-center gap-2"><span>â†©ï¸</span> ì‹¤í–‰ ì·¨ì†Œ</button>
                <button onclick="closeAppliedModal()" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-lg text-white font-bold transition">í™•ì¸</button>
            </div>
        </div>
    </div>
    
    <div id="decision-modal" class="fixed inset-0 z-[200] hidden items-center justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeDecisionModal()"></div>
        <div class="relative glass bg-gray-900 border border-gray-700 p-8 md:p-12 rounded-2xl max-w-2xl w-full mx-4 shadow-2xl transform transition-all scale-95 opacity-0 modal-content">
            <button onclick="closeDecisionModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button>
            <div class="flex items-center gap-4 mb-6">
                <span id="dm-icon" class="text-6xl"></span>
                <div><span id="dm-category" class="text-blue-400 font-bold uppercase tracking-wider text-sm"></span><h3 id="dm-title" class="text-3xl font-bold mt-1"></h3></div>
            </div>
            <div id="dm-content" class="bg-gray-800/50 p-6 rounded-xl border border-gray-700/50 mb-8 text-gray-300 text-lg leading-relaxed whitespace-pre-line"></div>
            <div class="flex justify-end gap-4">
                <button onclick="closeDecisionModal()" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-white font-bold transition">ë‹«ê¸°</button>
                <button id="btn-apply-decision" onclick="applyDecisionStrategy()" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-lg text-white font-bold transition flex items-center gap-2"><span>ğŸš€</span> ì „ëµ ì ìš©í•˜ê¸°</button>
            </div>
        </div>
    </div>
    
    <div id="video-modal" class="fixed inset-0 z-[300] hidden items-center justify-center bg-black/90">
         <div class="absolute inset-0" onclick="closeVideoModal()"></div>
         <div class="relative w-full max-w-5xl aspect-video bg-black rounded-xl overflow-hidden shadow-2xl">
             <button onclick="closeVideoModal()" class="absolute top-4 right-4 text-white text-3xl z-50 hover:text-red-500 transition">&times;</button>
             <video id="modal-video-player" class="w-full h-full" controls>
                 <source src="" type="video/mp4">
             </video>
         </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Video Modal
    function openVideoModal(src) {
        const modal = document.getElementById('video-modal');
        const video = document.getElementById('modal-video-player');
        video.src = src;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        video.play();
    }
    function closeVideoModal() {
        const modal = document.getElementById('video-modal');
        const video = document.getElementById('modal-video-player');
        video.pause();
        video.src = '';
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }

    // --- CSV & Chart Logic (Simplified Copy) ---
    // (Pasted logic from index_v2.html)
    
     function uploadCSV(input) {
            const file = input.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            // UI Feedback
            const btn = input.nextElementSibling;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>â³</span> ë¶„ì„ ì¤‘...';
            btn.disabled = true;

            fetch('/api/upload-csv/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    if(document.getElementById('ai-analysis-text')) document.getElementById('ai-analysis-text').innerText = data.analysis;
                    if(document.getElementById('center-cheer-msg')) document.getElementById('center-cheer-msg').innerText = data.cheer_msg;
                    
                    if(document.getElementById('stat-total-revenue')) document.getElementById('stat-total-revenue').innerText = data.total_revenue.toLocaleString() + 'ì›';
                    if(document.getElementById('stat-total-orders')) document.getElementById('stat-total-orders').innerText = data.total_orders.toLocaleString() + 'ê±´';

                    updateSalesChart(data.labels, data.data); 
                    
                    const overlay = document.getElementById('chart-overlay-msg');
                    if(overlay) overlay.style.opacity = '0';

                    alert('ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert('ì˜¤ë¥˜: ' + data.message);
                }
            })
            .catch(err => {
                console.error(err);
                alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            })
            .finally(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                input.value = ''; 
            });
        }

        function uploadPastCSV(input) {
            const file = input.files[0];
            if (!file) return;
            const formData = new FormData();
            formData.append('file', file);
            const btn = input.nextElementSibling;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>â³</span> ë¹„êµ ì¤‘...';
            btn.disabled = true;

            fetch('/api/upload-past-csv/', { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    let html = data.analysis.replace(/\*\*(.*?)\*\*/g, '<b class="text-purple-300">$1</b>');
                    html = html.replace(/\n/g, '<br>');
                    document.getElementById('past-analysis-text').innerHTML = html;
                    updatePastChart(data.pie_labels, data.pie_data);
                    alert('ë¹„êµ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ì˜¤ë¥˜: ' + data.message);
                }
            })
            .finally(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                input.value = '';
            });
        }
        
    // Charts
    function updateSalesChart(labels, data) {
         // Transform data for Highcharts Area 3D
         Highcharts.chart('salesChartContainer', {
             chart: {
                 type: 'area',
                 backgroundColor: 'rgba(0,0,0,0)',
                 options3d: {
                     enabled: true,
                     alpha: 15,
                     beta: 15,
                     depth: 50,
                     viewDistance: 25
                 }
             },
             title: { text: null },
             xAxis: {
                 categories: labels,
                 labels: { style: { color: '#9ca3af' } },
                 gridLineColor: 'rgba(255,255,255,0.1)'
             },
             yAxis: {
                 title: { text: null },
                 labels: { style: { color: '#9ca3af' } },
                 gridLineColor: 'rgba(255,255,255,0.1)'
             },
             plotOptions: {
                 area: {
                     depth: 25,
                     marker: { enabled: false },
                     states: { hover: { lineWidth: 1 } },
                     threshold: null
                 }
             },
             series: [{
                 name: 'ì‹¤ì‹œê°„ ë§¤ì¶œ',
                 data: data,
                 color: '#3b82f6',
                 fillColor: {
                     linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                     stops: [
                         [0, 'rgba(59, 130, 246, 0.5)'],
                         [1, 'rgba(59, 130, 246, 0)']
                     ]
                 },
                 lineColor: '#60a5fa'
             }],
             credits: { enabled: false },
             legend: { enabled: false }
         });
    }

    function updatePastChart(labels, data) {
         Highcharts.chart('pastSalesChart', {
            chart: { 
                type: 'pie', 
                backgroundColor: 'transparent', 
                options3d: { 
                    enabled: true, 
                    alpha: 45, 
                    beta: 0 
                } 
            },
            title: { text: null },
            accessibility: { point: { valueSuffix: '%' } },
            plotOptions: { 
                pie: { 
                    allowPointSelect: true, 
                    cursor: 'pointer', 
                    depth: 35, 
                    dataLabels: { 
                        enabled: true, 
                        format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                        style: { color: '#e5e7eb' }
                    } 
                } 
            },
            series: [{ 
                type: 'pie', 
                name: 'ë§¤ì¶œ ë¹„ì¤‘', 
                data: labels.map((l, i) => [l, data[i]]) 
            }],
            credits: { enabled: false }
        });
    }

    // Decision & Strategy
    let selectedDecision = null;
    let appliedStrategies = [];
    const strategiesData = {
            'sales': [
                { icon: 'ğŸ“¢', title: 'ê¸´ê¸‰ íƒ€ì„ ì„¸ì¼', summary: 'ì˜¤í›„ 2ì‹œ~4ì‹œ í•´í”¼ì•„ì›Œ 15% í• ì¸', score: 92, category: 'ë§¤ì¶œ ë¶€ìŠ¤íŒ…', detail: 'ìœ ë™ ì¸êµ¬ê°€ ë§ì§€ë§Œ ë°©ë¬¸ìœ¨ì´ ë–¨ì–´ì§€ëŠ” ì˜¤í›„ 2ì‹œë¶€í„° 4ì‹œ ì‚¬ì´ì— "í•´í”¼ì•„ì›Œ 15% í• ì¸" ì´ë²¤íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”.' },
                { icon: 'ğŸ°', title: 'ê°ë‹¨ê°€ ìƒìŠ¹ ì„¸íŠ¸', summary: 'ì•„ë©”ë¦¬ì¹´ë…¸ + ì¼€ì´í¬ 1ì¸ ì„¸íŠ¸ ì¶œì‹œ', score: 88, category: 'ë©”ë‰´ ìµœì í™”', detail: 'ë””ì €íŠ¸ íŒë§¤ëŸ‰ì´ ì €ì¡°í•©ë‹ˆë‹¤. ì¸ê¸° ìŒë£Œì¸ ì•„ë©”ë¦¬ì¹´ë…¸ì™€ ì¼€ì´í¬ë¥¼ ë¬¶ì€ "1ì¸ ë‹¬ì½¤ ì„¸íŠ¸"ë¥¼ ì¶œì‹œí•˜ì„¸ìš”.' },
                { icon: 'ğŸ›µ', title: 'ë°°ë‹¬ ì•± ê¹ƒë°œ ìµœì í™”', summary: 'ì£¼ë¬¸ ë°€ì§‘ ì§€ì—­ ê¹ƒë°œ ì¬ë°°ì¹˜', score: 85, category: 'ë°°ë‹¬ ë§ˆì¼€íŒ…', detail: 'íš¨ìœ¨ì´ ë‚®ì€ Aêµ¬ì—­ì˜ ê¹ƒë°œì„ ì£¼ë¬¸ëŸ‰ì´ ì¦ê°€í•˜ëŠ” Cêµ¬ì—­ìœ¼ë¡œ ì´ë™ì‹œí‚¤ì„¸ìš”.' }
            ],
            'profit': [
                { icon: 'ğŸ¥›', title: 'ì¬ê³  ì†Œì§„ í”„ë¡œëª¨ì…˜', summary: 'ìœ í†µê¸°í•œ ì„ë°• ìš°ìœ  í™œìš© ë¼ë–¼ í• ì¸', score: 94, category: 'ì¬ê³  ê´€ë¦¬', detail: 'ìœ í†µê¸°í•œ ì„ë°• ìš°ìœ  ì†Œì§„ì„ ìœ„í•´ "ì˜¤ëŠ˜ì˜ ë¼ë–¼" 10% í• ì¸ì„ ì§„í–‰í•˜ì„¸ìš”.' },
                { icon: 'ğŸ‘¥', title: 'ì¸ë ¥ íš¨ìœ¨í™”', summary: '15:00~16:00 íŒŒíŠ¸íƒ€ì„ íœ´ê²Œ ì‹œê°„', score: 89, category: 'ì¸ê±´ë¹„ ìµœì í™”', detail: 'í•´ë‹¹ ì‹œê°„ëŒ€ ë§¤ì¶œ ëŒ€ë¹„ ì¸ê±´ë¹„ ë¹„ì¤‘ì´ ë†’ìŠµë‹ˆë‹¤. ë¸Œë ˆì´í¬ íƒ€ì„ì„ í™œìš©í•˜ì„¸ìš”.' },
                { icon: 'âš¡', title: 'ì—ë„ˆì§€ ì ˆì•½', summary: 'í”¼í¬íƒ€ì„ ì „ë ¥ ì œì–´', score: 82, category: 'ìš´ì˜ ë¹„ìš©', detail: 'í”¼í¬íƒ€ì„ ì „ë ¥ ì†Œëª¨ë¥¼ ë§‰ê¸° ìœ„í•´ AI ìë™ ì œì–´ ì‹œìŠ¤í…œì„ ê°€ë™í•˜ì„¸ìš”.' }
            ],
            'customer': [
                { icon: 'ğŸ‘‘', title: 'ë‹¨ê³¨ ìš°ëŒ€ ìº í˜ì¸', summary: 'íœ´ë©´ VIP ì¿ í° ë°œì†¡', score: 95, category: 'CRM ë§ˆì¼€íŒ…', detail: 'ìµœê·¼ ë¯¸ë°©ë¬¸ VIP ê³ ê°ì—ê²Œ "ì›°ì»´ ë°± ë¬´ë£Œ ì»¤í”¼" ì¿ í°ì„ ë°œì†¡í•˜ì„¸ìš”.' },
                { icon: 'â­', title: 'ë¦¬ë·° ì´ë²¤íŠ¸', summary: 'í¬í†  ë¦¬ë·° ì‹œ ì¿ í‚¤ ì¦ì •', score: 90, category: 'ë°”ì´ëŸ´ ë§ˆì¼€íŒ…', detail: 'ì˜ìˆ˜ì¦ í¬í†  ë¦¬ë·° ì¸ì¦ ì‹œ ìˆ˜ì œ ì¿ í‚¤ë¥¼ ì œê³µí•˜ì—¬ ë¦¬ë·° ìˆ˜ë¥¼ ëŠ˜ë¦¬ì„¸ìš”.' },
                { icon: 'ğŸ‚', title: 'ìƒì¼ ì¶•í•˜', summary: 'ìƒì¼ ê³ ê° ì¡°ê° ì¼€ì´í¬', score: 88, category: 'ê°ë™ ê²½ì˜', detail: 'ì´ë²ˆ ì£¼ ìƒì¼ ê³ ê°ì—ê²Œ ì¡°ê° ì¼€ì´í¬ë¥¼ ì„ ë¬¼í•˜ì„¸ìš”.' }
            ]
    };

    function selectDecision(type) {
        selectedDecision = type;
        const types = ['sales', 'profit', 'customer'];
        types.forEach(t => {
            const el = document.getElementById(`decision-${t}`);
            if(t === type) { el.classList.add('scale-110'); el.classList.remove('opacity-50'); el.querySelector('div').classList.add('ring-4', 'ring-white'); }
            else { el.classList.remove('scale-110'); el.classList.add('opacity-50'); el.querySelector('div').classList.remove('ring-4', 'ring-white'); }
        });
    }

    function executeStrategy() {
        if(!selectedDecision) { alert('ì „ëµì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
        const btn = document.getElementById('btn-execute-strategy');
        btn.disabled = true; btn.innerHTML = 'ë¶„ì„ ì¤‘...';
        setTimeout(() => {
            btn.disabled = false; btn.innerHTML = 'ğŸš€ ì „ëµ ìŠ¹ì¸ ë° ì‹¤í–‰';
            openDecisionModal(selectedDecision);
        }, 800);
    }
    
    function openDecisionModal(type) {
         const modal = document.getElementById('decision-modal');
         const d = strategiesData[type][0]; // Demo: Show first strategy
         
         document.getElementById('dm-icon').innerText = {sales:'ğŸ’°', profit:'âš–ï¸', customer:'ğŸ’–'}[type];
         document.getElementById('dm-category').innerText = {sales:'ë§¤ì¶œ ì„±ì¥', profit:'ë¹„ìš© ì ˆê°', customer:'ê³ ê° ë§Œì¡±'}[type];
         document.getElementById('dm-title').innerText = d.category; 
         document.getElementById('dm-content').innerText = "AI ì¶”ì²œ ì „ëµ:\n" + d.title + "\n\n" + d.detail;

         modal.classList.remove('hidden'); modal.classList.add('flex');
         setTimeout(() => { modal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0'); modal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100'); }, 10);
    }
    function closeDecisionModal() {
        document.getElementById('decision-modal').classList.add('hidden');
        document.getElementById('decision-modal').classList.remove('flex');
    }
    function applyDecisionStrategy() {
        closeDecisionModal();
        alert('ì „ëµì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        // Ideally update UI here
    }
    function openAppliedModal() { document.getElementById('applied-modal').classList.remove('hidden'); document.getElementById('applied-modal').classList.add('flex'); }
    function closeAppliedModal() { document.getElementById('applied-modal').classList.add('hidden'); document.getElementById('applied-modal').classList.remove('flex'); }
    function undoLastStrategy() { alert('ì·¨ì†Œí•  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.'); }
    
    function updateOperationalStrategies(type) {
         // Logic to update strategy container (omitted for brevity, can be added if crucial)
    }

    function openStrategyModal(id) { document.getElementById(id).classList.remove('hidden'); document.getElementById(id).classList.add('flex'); }
    function closeStrategyModal(id) { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); }

    // Init Logic
    fetch("{% url 'dashboard_stats_api' %}")
        .then(r=>r.json())
        .then(d=>{
            if(d.status==='success'){
                 document.getElementById('prediction-value').innerText = 'â‚© ' + Number(d.prediction).toLocaleString();
                 if(d.weather.condition) {
                     document.getElementById('weather-cond').innerText = d.weather.condition;
                     document.getElementById('weather-temp').innerText = d.weather.temp + 'Â°';
                 }
                 document.getElementById('ai-analysis-text').innerText = d.analysis;
                 
                 // Update strategies
                 const container = document.getElementById('strategy-container');
                 const modalContainer = document.getElementById('modal-container');
                 container.innerHTML = '';
                 d.strategies.forEach((s,i) => {
                     const mid = `modal-${i}`;
                     container.insertAdjacentHTML('beforeend', `
                        <div onclick="openStrategyModal('${mid}')" class="glass p-8 rounded-2xl cursor-pointer hover:bg-white/5 transition transform hover:-translate-y-2 group relative overflow-hidden">
                             <div class="text-5xl mb-6">${s.icon}</div>
                             <h3 class="text-2xl font-bold mb-3">${s.title}</h3>
                             <p class="text-gray-400 mb-6">${s.summary}</p>
                             <div class="flex items-center gap-2"><div class="flex-1 h-2 bg-gray-700 rounded-full overflow-hidden"><div class="h-full bg-blue-500" style="width:${s.score}%"></div></div><span class="text-sm text-blue-400 font-bold">${s.score}ì </span></div>
                        </div>
                     `);
                     modalContainer.insertAdjacentHTML('beforeend', `
                        <div id="${mid}" class="fixed inset-0 z-[100] hidden items-center justify-center">
                            <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeStrategyModal('${mid}')"></div>
                             <div class="relative glass bg-gray-900 border border-gray-700 p-8 rounded-2xl max-w-2xl w-full mx-4 shadow-2xl modal-content">
                                <button onclick="closeStrategyModal('${mid}')" class="absolute top-4 right-4 text-gray-400">&times;</button>
                                <h3 class="text-3xl font-bold mb-4">${s.title}</h3>
                                <p class="text-gray-300 leading-relaxed">${s.detail}</p>
                            </div>
                        </div>
                     `);
                 });
            }
        });
</script>
{% endblock %}
