{% extends "admin/base.html" %}
{% load static %}

{% block title %}Îß§Ï∂úÏòàÏ∏° (AI) | Forkast ERP{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    /* ===== ERP STYLE RESET ===== */
    .forecast-page {
        font-family: 'Inter', 'Noto Sans KR', sans-serif;
        background: #f8fafa;
        min-height: 100vh;
        padding: 0;
    }

    /* ===== TOOLBAR ===== */
    .erp-toolbar {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
    }

    .erp-toolbar-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        font-size: 1rem; /* 16px */
        font-weight: 600;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: #ffffff;
        color: #374151;
        cursor: pointer;
        transition: all 0.15s;
    }

    .erp-toolbar-btn:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
    }

    .erp-toolbar-btn.primary {
        background: #0d6b62;
        color: #ffffff;
        border-color: #0d6b62;
    }

    .erp-toolbar-btn.primary:hover {
        background: #0a5a53;
    }

    .erp-toolbar-divider {
        width: 1px;
        height: 24px;
        background: #e5e7eb;
        margin: 0 8px;
    }

    /* ===== FILTER FORM ===== */
    .erp-filter {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 12px;
        padding: 16px 20px;
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
    }

    .erp-filter-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .erp-filter-field label {
        font-size: 1rem; /* 16px */
        font-weight: 700;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .erp-filter-field input,
    .erp-filter-field select {
        padding: 10px 16px;
        font-size: 1rem; /* 16px */
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: #ffffff;
    }

    .erp-filter-field input:focus,
    .erp-filter-field select:focus {
        outline: none;
        border-color: #0d6b62;
        box-shadow: 0 0 0 2px rgba(13, 107, 98, 0.1);
    }

    /* ===== KPI CARDS ===== */
    .erp-kpi-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        padding: 20px;
    }

    .erp-kpi-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 16px 20px;
    }

    .erp-kpi-card .label {
        font-size: 1rem; /* 16px */
        font-weight: 700;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }

    .erp-kpi-card .value {
        font-size: 1.875rem; /* 30px */
        font-weight: 800;
        color: #111827;
    }

    .erp-kpi-card .value .unit {
        font-size: 1rem; /* 16px */
        font-weight: 600;
        color: #6b7280;
        margin-left: 4px;
    }

    .erp-kpi-card .change {
        font-size: 1rem; /* 16px */
        font-weight: 600;
        margin-top: 8px;
    }

    .erp-kpi-card .change.up { color: #059669; }
    .erp-kpi-card .change.down { color: #dc2626; }
    .erp-kpi-card .change.warn { color: #d97706; }

    /* ===== CHART SECTION ===== */
    .erp-chart-section {
        padding: 0 20px 20px 20px;
    }

    .erp-chart-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 20px;
    }

    .erp-chart-title {
        font-size: 1.25rem; /* 20px */
        font-weight: 800;
        color: #111827;
        margin-bottom: 20px;
    }

    /* ===== DATA GRID ===== */
    .erp-grid-section {
        padding: 0 20px 20px 20px;
    }

    .erp-grid-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
    }

    .erp-grid-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
        background: #f9fafb;
    }

    .erp-grid-title {
        font-size: 13px;
        font-weight: 700;
        color: #374151;
    }

    .erp-grid table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
    }

    .erp-grid thead th {
        background: #f3f4f6;
        padding: 16px;
        text-align: left;
        font-weight: 800;
        color: #374151;
        border-bottom: 2px solid #e5e7eb;
        text-transform: uppercase;
        font-size: 1rem; /* 16px */
        letter-spacing: 0.5px;
    }

    .erp-grid thead th.num {
        text-align: right;
    }

    .erp-grid tbody td {
        padding: 16px;
        border-bottom: 1px solid #f3f4f6;
        color: #4b5563;
        font-size: 1rem; /* 16px */
    }

    .erp-grid tbody td.num {
        text-align: right;
        font-family: 'SF Mono', monospace;
        font-weight: 600;
        font-size: 1rem;
    }

    .erp-grid tbody tr:hover {
        background: #f0fdf9;
    }

    .erp-grid tbody td.pending {
        color: #9ca3af;
        font-style: italic;
    }

    .erp-grid .error-badge {
        display: inline-block;
        padding: 2px 6px;
        background: #fee2e2;
        color: #dc2626;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 700;
    }

    .erp-grid .ok-badge {
        display: inline-block;
        padding: 2px 6px;
        background: #d1fae5;
        color: #059669;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 700;
    }

    /* ===== BOTTOM TABS ===== */
    .erp-bottom-tabs {
        padding: 0 20px 20px 20px;
    }

    .erp-tabs-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
    }

    .erp-tabs-nav {
        display: flex;
        border-bottom: 1px solid #e5e7eb;
        background: #f9fafb;
    }

    .erp-tabs-nav button {
        padding: 12px 20px;
        font-size: 12px;
        font-weight: 600;
        color: #6b7280;
        background: none;
        border: none;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        margin-bottom: -1px;
    }

    .erp-tabs-nav button.active {
        color: #0d6b62;
        border-bottom-color: #0d6b62;
        background: #ffffff;
    }

    .erp-tabs-content {
        padding: 16px;
        font-size: 13px;
        color: #4b5563;
    }

    .erp-model-status {
        display: flex;
        gap: 32px;
    }

    .erp-model-status .item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .erp-model-status .item .label {
        font-size: 11px;
        color: #9ca3af;
        text-transform: uppercase;
    }

    .erp-model-status .item .val {
        font-size: 14px;
        font-weight: 600;
        color: #111827;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1200px) {
        .erp-kpi-row {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="forecast-page">

    <!-- TOOLBAR -->
    <div class="erp-toolbar">
        <button class="erp-toolbar-btn primary" onclick="handleQuery()">
            <i class="fa-solid fa-magnifying-glass"></i> Ï°∞Ìöå
        </button>
        <div class="erp-toolbar-divider"></div>
        <button class="erp-toolbar-btn" onclick="handleExcel()">
            <i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ
        </button>
        <button class="erp-toolbar-btn" onclick="handlePrint()">
            <i class="fa-solid fa-print"></i> Ïù∏ÏáÑ
        </button>
        <div class="erp-toolbar-divider"></div>
        <button class="erp-toolbar-btn" onclick="handleBatchRun()">
            <i class="fa-solid fa-play"></i> Î∞∞ÏπòÏã§Ìñâ
        </button>
        <div style="flex:1;"></div>
        <input type="text" placeholder="Îπ†Î•∏Í≤ÄÏÉâ..." style="padding:8px 12px; border:1px solid #d1d5db; border-radius:4px; font-size:12px; width:200px;">
    </div>

    <!-- FILTER FORM -->
    <div class="erp-filter">
        <div class="erp-filter-field">
            <label>ÏÇ¨ÏóÖÏû•</label>
            <select id="filter-store">
                <option value="">Ï†ÑÏ≤¥</option>
                <option value="S001">Î≥∏Ï†ê</option>
                <option value="S002">Í∞ïÎÇ®Ï†ê</option>
                <option value="S003">ÌôçÎåÄÏ†ê</option>
            </select>
        </div>
        <div class="erp-filter-field">
            <label>Í∏∞Í∞Ñ (ÏãúÏûë)</label>
            <input type="date" id="filter-from" value="2026-01-01">
        </div>
        <div class="erp-filter-field">
            <label>Í∏∞Í∞Ñ (Ï¢ÖÎ£å)</label>
            <input type="date" id="filter-to" value="2026-02-04">
        </div>
        <div class="erp-filter-field">
            <label>Ï±ÑÎÑê</label>
            <select id="filter-channel">
                <option value="">Ï†ÑÏ≤¥</option>
                <option value="STORE">Îß§Ïû•</option>
                <option value="DELIVERY">Î∞∞Îã¨</option>
            </select>
        </div>
        <div class="erp-filter-field">
            <label>ÏòàÏ∏°Í∏∞Í∞Ñ</label>
            <select id="filter-horizon">
                <option value="7">7Ïùº</option>
                <option value="14">14Ïùº</option>
                <option value="30">30Ïùº</option>
            </select>
        </div>
        <div class="erp-filter-field">
            <label>ÏßëÍ≥ÑÎã®ÏúÑ</label>
            <select id="filter-agg">
                <option value="day">ÏùºÎ≥Ñ</option>
                <option value="week">Ï£ºÎ≥Ñ</option>
            </select>
        </div>
    </div>

    <!-- KPI CARDS -->
    <div class="erp-kpi-row">
        <div class="erp-kpi-card">
            <div class="label">ÏòàÏÉÅÎß§Ï∂ú (7Ïùº)</div>
            <div class="value">‚Ç©124,500,000</div>
            <div class="change up">‚ñ≤ +8.2% Ï†ÑÏ£ºÎåÄÎπÑ</div>
        </div>
        <div class="erp-kpi-card">
            <div class="label">Ï†ÑÏ£º Ïã§Ï†Å</div>
            <div class="value">‚Ç©115,100,000</div>
            <div class="change">ÌôïÏ†ï</div>
        </div>
        <div class="erp-kpi-card">
            <div class="label">Î™©ÌëúÎã¨ÏÑ±Î•†</div>
            <div class="value">94.3<span class="unit">%</span></div>
            <div class="change down">Î™©Ìëú: ‚Ç©132,000,000</div>
        </div>
        <div class="erp-kpi-card">
            <div class="label">Ïù¥ÏÉÅÍ∞êÏßÄ</div>
            <div class="value">2<span class="unit">Í±¥</span></div>
            <div class="change warn">‚ö† Ïò§Ï∞®Ïú® 15% Ï¥àÍ≥º</div>
        </div>
    </div>

    <!-- CHART -->
    <div class="erp-chart-section">
        <div class="erp-chart-card">
            <div class="erp-chart-title">üìà Ïã§Ï†ú vs ÏòàÏ∏° Îß§Ï∂ú Ï∂îÏù¥</div>
            <canvas id="forecastChart" height="100"></canvas>
        </div>
    </div>

    <!-- Îç∞Ïù¥ÌÑ∞ Í∑∏Î¶¨Îìú ÏòÅÏó≠ -->
    <div class="erp-grid-section">
            <div class="erp-grid-header">
                <div class="flex flex-col">
                    <div class="erp-grid-title" style="font-size:1.5rem;">ÏòàÏ∏° Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î</div>
                    <div class="mt-4 flex items-center gap-4">
                        <span style="font-size: 16px; font-weight: 800; color: #64748b; background: #f1f5f9; padding: 4px 16px; border-radius: 4px; border: 1px solid #cbd5e1;">ÌÖåÏù¥Î∏î: PLATFORM_UI_DAILYSALES</span>
                        <span style="font-size: 16px; color: #64748b; font-weight: 500;">| ÏöîÏïΩ ÏÑ§Î™Ö: Í∞ÄÎßπÏ†êÎ≥Ñ ÏùºÏùº Îß§Ï∂ú Ïã§Ï†ÅÍ≥º Í≥ºÍ±∞ Ìå®ÌÑ¥ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Î•º Í¥ÄÎ¶¨ÌïòÎäî ÌÖåÏù¥Î∏î</span>
                    </div>
                </div>
            </div>    <span style="font-size:1rem; color:#6b7280;">Ï¥ù 14Í±¥</span>
            </div>
            <div class="erp-grid">
                <table>
                    <thead>
                        <tr>
                            <th style="width:40px;"><input type="checkbox"></th>
                            <th>ÎÇ†Ïßú</th>
                            <th class="num">ÏòàÏ∏°Îß§Ï∂ú</th>
                            <th class="num">ÌïòÌïú(Lo)</th>
                            <th class="num">ÏÉÅÌïú(Hi)</th>
                            <th class="num">Ïã§Ï†úÎß§Ï∂ú</th>
                            <th class="num">Ïò§Ï∞®Ïú®</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-10</td>
                            <td class="num">‚Ç©18,900,000</td>
                            <td class="num">‚Ç©16,500,000</td>
                            <td class="num">‚Ç©21,300,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-09</td>
                            <td class="num">‚Ç©17,800,000</td>
                            <td class="num">‚Ç©15,500,000</td>
                            <td class="num">‚Ç©20,100,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-08</td>
                            <td class="num">‚Ç©16,500,000</td>
                            <td class="num">‚Ç©14,200,000</td>
                            <td class="num">‚Ç©18,800,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-07</td>
                            <td class="num">‚Ç©19,200,000</td>
                            <td class="num">‚Ç©17,000,000</td>
                            <td class="num">‚Ç©21,400,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-06</td>
                            <td class="num">‚Ç©15,800,000</td>
                            <td class="num">‚Ç©13,500,000</td>
                            <td class="num">‚Ç©18,100,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-05</td>
                            <td class="num">‚Ç©17,200,000</td>
                            <td class="num">‚Ç©15,000,000</td>
                            <td class="num">‚Ç©19,400,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-04</td>
                            <td class="num">‚Ç©16,800,000</td>
                            <td class="num">‚Ç©14,600,000</td>
                            <td class="num">‚Ç©19,000,000</td>
                            <td class="num pending">-</td>
                            <td class="num pending">-</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-03</td>
                            <td class="num">‚Ç©16,400,000</td>
                            <td class="num">‚Ç©14,200,000</td>
                            <td class="num">‚Ç©18,600,000</td>
                            <td class="num">‚Ç©16,800,000</td>
                            <td class="num"><span class="ok-badge">-2.4%</span></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-02</td>
                            <td class="num">‚Ç©18,500,000</td>
                            <td class="num">‚Ç©16,200,000</td>
                            <td class="num">‚Ç©20,800,000</td>
                            <td class="num">‚Ç©19,200,000</td>
                            <td class="num"><span class="ok-badge">-3.6%</span></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"></td>
                            <td>2026-02-01</td>
                            <td class="num">‚Ç©14,500,000</td>
                            <td class="num">‚Ç©12,300,000</td>
                            <td class="num">‚Ç©16,700,000</td>
                            <td class="num">‚Ç©12,200,000</td>
                            <td class="num"><span class="error-badge">+18.9%</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- BOTTOM TABS -->
    <div class="erp-bottom-tabs">
        <div class="erp-tabs-card">
            <div class="erp-tabs-nav">
                <button class="active" onclick="switchTab(this, 'tab-model')">Î™®Îç∏ÏÉÅÌÉú</button>
                <button onclick="switchTab(this, 'tab-batch')">Î∞∞ÏπòÎ°úÍ∑∏</button>
                <button onclick="switchTab(this, 'tab-feature')">ÌîºÏ≤òÎç∞Ïù¥ÌÑ∞</button>
                <button onclick="switchTab(this, 'tab-alert')">ÏïåÎ¶ºÍ∑úÏπô</button>
            </div>
            <div class="erp-tabs-content" id="tab-model">
                <div class="erp-model-status">
                    <div class="item">
                        <span class="label">Î™®Îç∏Î≤ÑÏ†Ñ</span>
                        <span class="val">v2.3.1</span>
                    </div>
                    <div class="item">
                        <span class="label">ÌïôÏäµÏùº</span>
                        <span class="val">2026-02-03 03:10</span>
                    </div>
                    <div class="item">
                        <span class="label">ÌèâÍ∑†Ï†àÎåÄÏò§Ï∞® (MAE)</span>
                        <span class="val">4.2%</span>
                    </div>
                    <div class="item">
                        <span class="label">ÌèâÍ∑†Ï†àÎåÄÎ∞±Î∂ÑÏú®Ïò§Ï∞® (MAPE)</span>
                        <span class="val">5.8%</span>
                    </div>
                    <div class="item">
                        <span class="label">ÌïôÏäµÎç∞Ïù¥ÌÑ∞</span>
                        <span class="val">365Ïùº</span>
                    </div>
                </div>
            </div>
            <div class="erp-tabs-content" id="tab-batch" style="display:none;">
                <p>Î∞∞ÏπòÎ°úÍ∑∏: ÏµúÍ∑º Ïã§Ìñâ ÎÇ¥Ïó≠Ïù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
            </div>
            <div class="erp-tabs-content" id="tab-feature" style="display:none;">
                <p>ÌîºÏ≤òÎç∞Ïù¥ÌÑ∞: Î™®Îç∏ ÏûÖÎ†• ÌîºÏ≤ò Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
            </div>
            <div class="erp-tabs-content" id="tab-alert" style="display:none;">
                <p>ÏïåÎ¶ºÍ∑úÏπô: Ïù¥ÏÉÅÍ∞êÏßÄ Ï°∞Í±¥ ÏÑ§Ï†ïÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
            </div>
        </div>
    </div>

</div>

<script>
    // Tab Switching
    function switchTab(btn, tabId) {
        document.querySelectorAll('.erp-tabs-nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.erp-tabs-content').forEach(c => c.style.display = 'none');
        btn.classList.add('active');
        document.getElementById(tabId).style.display = 'block';
    }

    // Toolbar Actions (Stubs)
    function handleQuery() { alert('Ï°∞Ìöå Ïã§Ìñâ'); }
    function handleExcel() { alert('ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú'); }
    function handlePrint() { alert('Ïù∏ÏáÑ'); }
    function handleBatchRun() { 
        if(confirm('ÏòàÏ∏° Î∞∞ÏπòÎ•º ÏàòÎèô Ïã§ÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
            alert('Î∞∞Ïπò Ïã§Ìñâ ÏöîÏ≤≠Îê®');
        }
    }

    // Chart.js - Actual vs Predicted
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('forecastChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['01/28', '01/29', '01/30', '01/31', '02/01', '02/02', '02/03', '02/04', '02/05', '02/06', '02/07'],
                datasets: [
                    {
                        label: 'Ïã§Ï†ú Îß§Ï∂ú',
                        data: [15800000, 17200000, 18900000, 14500000, 12200000, 19200000, 16800000, null, null, null, null],
                        borderColor: '#0d6b62',
                        backgroundColor: 'rgba(13, 107, 98, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 4,
                    },
                    {
                        label: 'ÏòàÏ∏° Îß§Ï∂ú',
                        data: [15500000, 17000000, 18500000, 14800000, 14500000, 18500000, 16400000, 16800000, 17200000, 15800000, 19200000],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0.3,
                        fill: false,
                        pointRadius: 4,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: { size: 11, weight: '600' }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                return '‚Ç©' + value.toLocaleString();
                            },
                            font: { size: 14 }
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
