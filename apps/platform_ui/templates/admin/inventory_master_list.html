{% extends "admin/change_list.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* ==========================================
       [1] HIGH CONTRAST & ACCESSIBILITY COLORS
       ========================================== */
    :root {
        /* [Light Mode] Defaults */
        --bg-color: #F7F7F5;
        --card-bg: #FFFFFF;
        
        /* Font Colors (Strict) */
        --text-base: #1F2937;   /* Í∏∞Î≥∏ Î≥∏Î¨∏ */
        --text-bold: #0F172A;   /* Ï§ëÏöî ÌÖçÏä§Ìä∏ (Ï†úÎ™©, Ïà´Ïûê) */
        --text-desc: #475569;   /* Î≥¥Ï°∞ ÏÑ§Î™Ö */
        --text-disabled: #9CA3AF; /* ÎπÑÌôúÏÑ± */

        /* Table */
        --table-header-bg: #F8FAFC;
        --table-header-text: #111827; /* Ìó§Îçî Í∞ïÏ°∞ */
        --table-row-bg: #FFFFFF;
        --table-row-hover: #F8FAFC;
        --table-border: #E2E8F0;

        /* Status Badges */
        --badge-sale-bg: #DCFCE7;
        --badge-sale-text: #14532D;
        --badge-stop-bg: #E5E7EB;
        --badge-stop-text: #374151;
        --badge-out-bg: #FEE2E2;
        --badge-out-text: #7F1D1D;
        
        /* Category Badge */
        --badge-cat-bg: #F1F5F9;
        --badge-cat-text: #475569;

        /* Stock Status Numbers */
        --stock-normal: #0F172A;
        --stock-warning: #92400E;
        --stock-danger: #B91C1C;
        --stock-safe-label: #64748B;

        /* Action Button */
        --btn-manage-bg: #FFFFFF;
        --btn-manage-text: #0F172A;
        --btn-manage-border: #CBD5E1;
        
        /* Brand */
        --primary-brand: #0d9488;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            /* [Dark Mode] Overrides */
            --bg-color: #111827;
            --card-bg: #1F2937;

            /* Font Colors */
            --text-base: #E5E7EB;
            --text-bold: #F9FAFB;
            --text-desc: #CBD5E1;
            --text-disabled: #64748B;

            /* Table */
            --table-header-bg: #1F2937;
            --table-header-text: #F8FAFC;
            --table-row-bg: #1F2937;
            --table-row-hover: #374151;
            --table-border: #374151;

            /* Status Badges */
            --badge-sale-bg: #14532D;
            --badge-sale-text: #DCFCE7;
            --badge-stop-bg: #334155;
            --badge-stop-text: #E5E7EB;
            --badge-out-bg: #7F1D1D;
            --badge-out-text: #FEE2E2;
            
            /* Category Badge */
            --badge-cat-bg: #334155;
            --badge-cat-text: #E2E8F0;

            /* Stock */
            --stock-normal: #F9FAFB;
            --stock-warning: #FBBF24;
            --stock-danger: #F87171;
            --stock-safe-label: #9CA3AF;

            /* Action Button */
            --btn-manage-bg: #374151;
            --btn-manage-text: #F9FAFB;
            --btn-manage-border: #4B5563;
        }
    }

    /* [CRITICAL] MANUAL DARK MODE OVERRIDE */
    [data-theme="dark"] {
        --bg-color: #111827 !important;
        --card-bg: #1F2937 !important;
        --text-base: #E5E7EB !important;
        --text-bold: #F9FAFB !important;
        --text-desc: #CBD5E1 !important;
        --text-disabled: #64748B !important;
        --table-header-bg: #1F2937 !important;
        --table-header-text: #F8FAFC !important;
        --table-row-bg: #1F2937 !important;
        --table-row-hover: #374151 !important;
        --table-border: #374151 !important;
        --badge-sale-bg: #14532D !important;
        --badge-sale-text: #DCFCE7 !important;
        --badge-stop-bg: #334155 !important;
        --badge-stop-text: #E5E7EB !important;
        --badge-out-bg: #7F1D1D !important;
        --badge-out-text: #FEE2E2 !important;
        --badge-cat-bg: #334155 !important;
        --badge-cat-text: #E2E8F0 !important;
        --stock-normal: #F9FAFB !important;
        --stock-warning: #FBBF24 !important;
        --stock-danger: #F87171 !important;
        --stock-safe-label: #9CA3AF !important;
        --btn-manage-bg: #374151 !important;
        --btn-manage-text: #F9FAFB !important;
        --btn-manage-border: #4B5563 !important;
        --primary-brand: #0d9488 !important;
    }

    /* [CRITICAL] MANUAL LIGHT MODE OVERRIDE */
    [data-theme="light"] {
        --bg-color: #F7F7F5 !important;
        --card-bg: #FFFFFF !important;
        --text-base: #1F2937 !important;
        --text-bold: #0F172A !important;
        --text-desc: #475569 !important;
        --text-disabled: #9CA3AF !important;
        --table-header-bg: #F8FAFC !important;
        --table-header-text: #111827 !important;
        --table-row-bg: #FFFFFF !important;
        --table-row-hover: #F8FAFC !important;
        --table-border: #E2E8F0 !important;
        --badge-sale-bg: #DCFCE7 !important;
        --badge-sale-text: #14532D !important;
        --badge-stop-bg: #E5E7EB !important;
        --badge-stop-text: #374151 !important;
        --badge-out-bg: #FEE2E2 !important;
        --badge-out-text: #7F1D1D !important;
        --badge-cat-bg: #F1F5F9 !important;
        --badge-cat-text: #475569 !important;
        --stock-normal: #0F172A !important;
        --stock-warning: #92400E !important;
        --stock-danger: #B91C1C !important;
        --stock-safe-label: #64748B !important;
        --btn-manage-bg: #FFFFFF !important;
        --btn-manage-text: #0F172A !important;
        --btn-manage-border: #CBD5E1 !important;
        --primary-brand: #0d9488 !important;
    }

    /* ==========================================
       [2] GLOBAL STYLES (Variables Applied)
       ========================================== */
    body {
        background-color: var(--bg-color) !important;
        color: var(--text-base) !important;
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, SYSTEM-UI, Roboto, sans-serif !important;
    }
    
    .main-content-wrapper {
        background-color: var(--bg-color) !important;
        padding: 32px 40px !important;
    }
    
    #content {
        background: transparent !important;
        box-shadow: none !important;
        padding: 0 !important;
        border-radius: 0 !important;
    }
    
    h1 {
        font-size: 24px !important;
        font-weight: 800 !important;
        color: var(--text-bold) !important;
        margin-bottom: 24px !important;
        letter-spacing: -0.02em !important;
    }

    /* ==========================================
       [3] DASHBOARD CARDS
       ========================================== */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 24px;
    }
    
    .dashboard-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        border: 1px solid var(--table-border);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 110px;
        transition: all 0.2s ease-in-out;
        position: relative;
        overflow: hidden;
    }
    
    .dashboard-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        border-color: var(--primary-brand);
    }
    
    .dashboard-card::after {
        content: '';
        position: absolute;
        top: -10px;
        right: -10px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        opacity: 0.1;
        z-index: 0;
    }

    .card-label {
        font-size: 14px;
        color: var(--text-desc) !important;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        position: relative;
        z-index: 1;
    }
    
    .card-value {
        font-size: 36px;
        font-weight: 800;
        color: var(--text-bold) !important;
        font-family: 'Outfit', sans-serif;
        letter-spacing: -1.5px;
        line-height: 1;
        position: relative;
        z-index: 1;
    }
    
    /* Card Variants */
    .card-total { border-left: 4px solid var(--text-bold); }
    .card-total .card-value { color: var(--text-bold) !important; }
    .card-total::after { background: var(--text-bold); }
    
    .card-active { border-left: 4px solid #059669; }
    .card-active .card-value { color: #059669; }
    .card-active::after { background: #059669; }
    
    .card-warning { border-left: 4px solid #ea580c; }
    .card-warning .card-value { color: #ea580c; }
    .card-warning::after { background: #ea580c; }

    .card-stopped { border-left: 4px solid #9ca3af; }
    .card-stopped .card-value { color: #9ca3af; }
    .card-stopped::after { background: #9ca3af; }

    /* ==========================================
       [4] LIST TABLE
       ========================================== */
    #changelist {
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        border: 1px solid var(--table-border);
        overflow: hidden;
    }
    
    #changelist-form { margin-bottom: 0 !important; }
    
    .actions {
        padding: 16px 20px !important;
        background: var(--card-bg) !important;
        border-bottom: 1px solid var(--table-border) !important;
        color: var(--text-desc) !important;
    }
    
    #result_list { width: 100%; border-collapse: collapse; }

    #result_list thead th {
        background: var(--table-header-bg) !important;
        color: var(--table-header-text) !important;
        font-size: 13px !important;
        font-weight: 700 !important;
        padding: 14px 24px !important;
        border-bottom: 2px solid var(--table-border) !important;
        text-transform: uppercase;
        text-align: left;
    }
    
    #result_list tbody td,
    #result_list tbody th {
        background: var(--table-row-bg) !important;
        padding: 16px 24px !important;
        border-bottom: 1px solid var(--table-border) !important;
        font-size: 14px !important;
        vertical-align: middle !important;
        color: var(--text-base) !important;
        transition: background-color 0.15s;
    }
    
    #result_list tbody tr:hover td,
    #result_list tbody tr:hover th {
        background-color: var(--table-row-hover) !important;
    }

    /* Force link colors to respect theme */
    #result_list tbody a {
        color: var(--text-base) !important;
        text-decoration: none;
        font-weight: 600;
    }
    #result_list tbody a:hover {
        color: var(--primary-brand) !important;
        text-decoration: underline;
    }

    .action-checkbox { width: 40px; text-align: center; }

    /* ==========================================
       [5] BADGES & BUTTONS
       ========================================== */
    /* Manage Button - High Specificity */
    #result_list .manage-btn, 
    a.manage-btn, 
    .manage-btn {
        display: inline-block;
        padding: 4px 12px;
        font-size: 12px;
        font-weight: 600;
        background: var(--btn-manage-bg) !important;
        background-image: none !important;
        color: var(--btn-manage-text) !important;
        border: 1px solid var(--btn-manage-border) !important;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        white-space: nowrap;
        border-radius: 6px;
        transition: all 0.2s;
        text-shadow: none !important;
        text-decoration: none !important;
        line-height: normal;
    }
    a.manage-btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        background: var(--btn-manage-bg) !important;
        color: var(--btn-manage-text) !important;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* Badges */
    .badge-sale {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 700;
        text-align: center;
        min-width: 64px;
        border: 1px solid transparent;
    }
    .badge-sale-on {
        background: var(--badge-sale-bg) !important;
        color: var(--badge-sale-text) !important;
    }
    .badge-sale-stopped {
        background: var(--badge-stop-bg) !important;
        color: var(--badge-stop-text) !important;
    }
    .badge-sale-out {
        background: var(--badge-out-bg) !important;
        color: var(--badge-out-text) !important;
    }
    
    .badge-cat {
        background: var(--badge-cat-bg) !important;
        color: var(--badge-cat-text) !important;
        padding: 4px 10px; 
        border-radius: 99px; 
        font-size: 11px; 
        font-weight: 600; 
        border: 1px solid rgba(0,0,0,0.05);
        display: inline-block;
    }

    /* Stock Text Colors */
    .text-gray-900 { color: var(--stock-normal) !important; }
    .text-red-600 { color: var(--stock-danger) !important; }
    .text-amber-600 { color: var(--stock-warning) !important; }
    .text-gray-400 { color: var(--stock-safe-label) !important; }

    /* Search Bar */
    #searchbar {
        background-color: var(--card-bg) !important;
        color: var(--text-base) !important;
        border: 1px solid var(--table-border) !important;
        width: 360px !important;
        padding: 12px 16px 12px 40px !important;
        border-radius: 8px !important;
        font-size: 14px !important;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239CA3AF'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: 12px center;
        background-size: 20px;
    }
    
    .paginator {
        background: var(--card-bg) !important;
        border-top: 1px solid var(--table-border) !important;
        padding: 16px 24px !important;
        color: var(--text-desc) !important;
        font-weight: 500;
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;
    }

    /* ==========================================
       [6] FORCE WHITE INPUTS (ACCESSIBILITY)
       - All inputs must be white background
       - Text must be dark (even in dark mode)
       ========================================== */
    input[type="text"],
    input[type="password"],
    input[type="email"],
    input[type="number"],
    input[type="url"],
    input[type="search"],
    textarea,
    select {
        background-color: #FFFFFF !important;
        border: 1px solid #D1D5DB !important; /* Tailwind gray-300 */
        color: #1F2937 !important; /* Default Light Mode Text */
        padding: 8px 12px !important; /* Touch target size */
        border-radius: 6px !important;
    }
    
    ::placeholder {
        color: #9CA3AF !important;
    }

    /* Dark Mode Text Override */
    @media (prefers-color-scheme: dark) {
        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="number"],
        input[type="url"],
        input[type="search"],
        textarea,
        select {
             /* Background stays White */
            color: #111827 !important; /* Very Dark Grey for White BG */
            border-color: #9CA3AF !important; /* Slightly darker border for contrast */
        }
        ::placeholder {
            color: #6B7280 !important;
        }
    }

    /* [CRITICAL FIX] Force TH background in Dark Mode */
    [data-theme="dark"] #result_list tbody th,
    [data-theme="dark"] #result_list tbody td {
        background-color: #1F2937 !important;
        color: #E5E7EB !important;
        border-bottom-color: #374151 !important;
    }

    [data-theme="dark"] #result_list tbody th a,
    [data-theme="dark"] #result_list tbody td a {
        color: #E5E7EB !important;
    }
    
    [data-theme="dark"] #result_list tbody tr:hover th,
    [data-theme="dark"] #result_list tbody tr:hover td {
        background-color: #374151 !important;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800&family=Pretendard:wght@400;500;600;700;800&display=swap" rel="stylesheet">
{% endblock %}

{% block content_title %}{% endblock %}

{% block result_list %}
    <!-- SCREEN TITLE -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h1 style="margin:0 !important; color: var(--text-bold) !important;">üì¶ ÏÉÅÌíà Î∞è Ïû¨Í≥† ÎßàÏä§ÌÑ∞ Í¥ÄÎ¶¨</h1>
        <!-- Search Bar moved here if possible, but let's stick to standard flow -->
    </div>

    <!-- DASHBOARD CARDS -->
    <div class="dashboard-grid">
        <div class="dashboard-card card-total">
            <div class="card-label"><i class="fa-solid fa-cloud"></i> Ï†ÑÏ≤¥ Îì±Î°ù ÏÉÅÌíà</div>
            <div class="card-value">{{ summary_total|default:"0" }}</div>
        </div>
        <div class="dashboard-card card-active">
            <div class="card-label"><i class="fa-solid fa-circle-check"></i> ÌåêÎß§Ï§ë (On Sale)</div>
            <div class="card-value">{{ summary_active|default:"0" }}</div>
        </div>
        <div class="dashboard-card card-warning">
            <div class="card-label"><i class="fa-solid fa-triangle-exclamation"></i> Ïû¨Í≥† Î∂ÄÏ°± ÏïåÎ¶º</div>
            <div class="card-value">{{ summary_warning|default:"0" }}</div>
        </div>
        <div class="dashboard-card card-stopped">
            <div class="card-label"><i class="fa-solid fa-ban"></i> ÌåêÎß§/Í±∞Îûò Ï§ëÏßÄ</div>
            <div class="card-value">{{ summary_stopped|default:"0" }}</div>
        </div>
    </div>

    <!-- MAIN LIST -->
    {{ block.super }}

{% endblock %}
