{% extends 'platform_ui/base.html' %}
{% load static humanize %}

{% block title %}SCM í†µí•© ê´€ì œ ì½˜ì†” - Forkast AI{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

    :root {
        --erp-bg: #f8fafc;
        --erp-card: #ffffff;
        --erp-border: #e2e8f0;
        --erp-primary: #2563eb;
        --erp-primary-hover: #1d4ed8;
        --erp-text-main: #0f172a;
        --erp-text-muted: #64748b;
        --erp-accent: #3b82f6;
        --erp-success: #10b981;
        --erp-warning: #f59e0b;
        --erp-danger: #ef4444;
    }

    body.dark-mode {
        --erp-bg: #0f172a;
        --erp-card: #1e293b;
        --erp-border: #334155;
        --erp-text-main: #f8fafc; /* Slate 50 */
        --erp-text-muted: #cbd5e1; /* Slate 300 (Much brighter) */
        --erp-accent: #60a5fa;
        --erp-table-head: #1e293b;
        --erp-table-zebra: #1e293b88;
        --erp-hover: #334155;
        --erp-input-bg: #0f172a;
    }

    :root {
        --erp-table-head: #f1f5f9;
        --erp-table-zebra: #f8fafc;
        --erp-hover: #f1f5f9;
        --erp-input-bg: #ffffff;
    }

    body {
        background-color: var(--erp-bg);
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        color: var(--erp-text-main);
        letter-spacing: -0.01em;
    }

    .erp-section-title {
        font-size: 1.5rem; /* ~24px */
        font-weight: 800;
        letter-spacing: -0.01em;
        margin-bottom: 1.25rem; /* 20px */
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .erp-card {
        background: var(--erp-card);
        border: 1px solid var(--erp-border);
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
        transition: transform 0.2s, box-shadow 0.2s;
        overflow: hidden;
    }

    .erp-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.08);
    }

    .erp-table thead {
        background-color: var(--erp-table-head);
        border-bottom: 2px solid var(--erp-border);
    }

    .erp-table th {
        color: var(--erp-text-muted);
        font-weight: 700;
        font-size: 1rem; /* 16px */
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 1rem; /* 16px */
        text-align: left;
    }

    .erp-table td {
        padding: 1rem; /* 16px */
        border-bottom: 1px solid var(--erp-border);
        font-size: 1rem; /* 16px */
        color: var(--erp-text-main);
    }

    /* Zebra Striping */
    .erp-table tbody tr:nth-child(even) {
        background-color: var(--erp-table-zebra);
    }

    .erp-table tbody tr:hover {
        background-color: var(--erp-hover);
    }

    .erp-btn-primary {
        background-color: var(--erp-primary);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        gap: 0.625rem;
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
    }

    .erp-btn-primary:hover {
        background-color: var(--erp-primary-hover);
        transform: translateY(-1px);
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
    }

    .status-badge {
        padding: 8px 16px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 16px;
    }

    .status-approved { background-color: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }
    .status-pending { background-color: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.2); }
    .status-low { background-color: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }

    /* Custom Forms */
    .erp-input {
        width: 100%;
        padding: 0.875rem 1rem;
        background-color: var(--erp-input-bg);
        border: 1px solid var(--erp-border);
        border-radius: 12px;
        font-size: 1rem; /* 16px */
        color: var(--erp-text-main);
        transition: all 0.2s;
        outline: none;
    }

    .erp-input:focus {
        border-color: var(--erp-primary);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .animate-fade-in {
        animation: fadeIn 0.4s ease-out forwards;
    }

    /* Force Layout Constraints */
    .custom-container {
        max-width: 1400px !important;
        width: 90% !important;
        margin-left: auto !important;
        margin-right: auto !important;
        padding-left: 5vw !important; /* Viewport based padding */
        padding-right: 5vw !important;
        box-sizing: border-box !important;
    }
    
    @media (min-width: 1536px) { /* 2xl screens */
        .custom-container {
            max-width: 1300px !important; /* Slightly wider on huge screens */
            padding-left: 4rem !important;
            padding-right: 4rem !important;
        }
    }

    /* Dark Mode Overrides for Tailwind Utilities */
    [data-theme="dark"] .text-slate-900,
    [data-theme="dark"] .text-slate-800,
    [data-theme="dark"] .text-slate-700 {
        color: #ffffff !important; /* Pure white for best visibility */
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .text-slate-600,
    [data-theme="dark"] .text-slate-500 {
        color: #e2e8f0 !important; /* Slate-200 - Brighter for visibility */
    }
    
    [data-theme="dark"] .text-slate-400 {
        color: #cbd5e1 !important; /* Slate-200 - Much brighter */
    }

    /* Light Mode Accessibility - Slate-400 is too light on white */
    [data-theme="light"] .text-slate-400 {
        color: #475569 !important; /* Slate-600 - Visible on white */
    }
    [data-theme="light"] .text-slate-500 {
        color: #334155 !important; /* Slate-800 - Clearer */
    }

    [data-theme="dark"] .text-blue-600 {
        color: #93c5fd !important; /* Blue-300 - Brighter */
    }
    
    [data-theme="dark"] .text-blue-700 {
        color: #60a5fa !important; /* Blue-400 */
    }
    
    [data-theme="dark"] .text-indigo-600 {
        color: #a5b4fc !important; /* Indigo-300 */
    }
    
    [data-theme="dark"] .text-indigo-700 {
        color: #818cf8 !important; /* Indigo-400 */
    }
    
    [data-theme="dark"] .text-rose-600 {
        color: #fda4af !important; /* Rose-300 */
    }
    
    [data-theme="dark"] .text-rose-700 {
        color: #fb7185 !important; /* Rose-400 */
    }
    
    [data-theme="dark"] .text-amber-600 {
        color: #fcd34d !important; /* Amber-300 */
    }
    
    [data-theme="dark"] .text-amber-700,
    [data-theme="dark"] .text-amber-800 {
        color: #fbbf24 !important; /* Amber-400 */
    }
    
    [data-theme="dark"] .text-emerald-600 {
        color: #6ee7b7 !important; /* Emerald-300 */
    }
    
    [data-theme="dark"] .text-emerald-700 {
        color: #34d399 !important; /* Emerald-400 */
    }

    /* Dark Mode - Heading styles */
    [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 {
        color: #ffffff !important;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
    }
    
    /* Dark Mode - Card and badge text visibility */
    [data-theme="dark"] .erp-card, [data-theme="dark"] .erp-table {
        color: #f1f5f9 !important;
    }
    
    [data-theme="dark"] .badge, [data-theme="dark"] .status-badge {
        font-weight: 800 !important;
    }
    
    /* Dark Mode - Input fields */
    [data-theme="dark"] input, [data-theme="dark"] .erp-input {
        color: #f1f5f9 !important;
        background-color: #0f172a !important;
        border-color: #475569 !important;
    }
    
    [data-theme="dark"] input::placeholder {
        color: #64748b !important;
    }

    [data-theme="dark"] .bg-white {
        background-color: #1e293b !important; /* Slate-800 */
        border-color: #334155 !important;
    }

    [data-theme="dark"] .bg-slate-50 {
        background-color: #0f172a !important; /* Slate-900 */
        border-color: #1e293b !important;
    }

    [data-theme="dark"] .border-slate-100,
    [data-theme="dark"] .border-slate-200 {
        border-color: #475569 !important; /* Slate-600 for more visibility */
    }
    
    /* Section Specific Background Adjustments */
    [data-theme="dark"] .bg-blue-50\/30,
    [data-theme="dark"] .bg-blue-50 {
        background-color: rgba(59, 130, 246, 0.15) !important;
    }
    
    [data-theme="dark"] .bg-indigo-50\/30,
    [data-theme="dark"] .bg-indigo-50 {
        background-color: rgba(99, 102, 241, 0.15) !important;
    }
    
    [data-theme="dark"] .bg-rose-50\/30,
    [data-theme="dark"] .bg-rose-50 {
        background-color: rgba(244, 63, 94, 0.15) !important;
    }
    
    [data-theme="dark"] .bg-amber-50\/30,
    [data-theme="dark"] .bg-amber-50 {
        background-color: rgba(245, 158, 11, 0.15) !important;
    }
    
    [data-theme="dark"] .bg-emerald-50 {
        background-color: rgba(16, 185, 129, 0.15) !important;
    }
    
    /* Table Stripes */
    [data-theme="dark"] .hover\:bg-blue-50\/50:hover {
        background-color: rgba(59, 130, 246, 0.2) !important;
    }
    
    [data-theme="dark"] .bg-amber-50\/50 {
        background-color: rgba(245, 158, 11, 0.15) !important;
        border-color: rgba(245, 158, 11, 0.3) !important;
    }
    
    [data-theme="dark"] .bg-amber-200 {
        background-color: rgba(245, 158, 11, 0.35) !important;
        color: #fef3c7 !important;
    }
    
    [data-theme="dark"] .bg-amber-100 {
        background-color: rgba(245, 158, 11, 0.25) !important;
        color: #fcd34d !important;
    }
    
    /* Light Mode - Ensure strong contrasts */
    [data-theme="light"] .text-slate-400,
    [data-theme="light"] .text-slate-500 {
        color: #475569 !important; /* Darker for light mode */
    }
    
    [data-theme="light"] .text-slate-600 {
        color: #334155 !important;
    }
</style>
{% endblock %}
{% block content %}
<div class="h-full py-5 px-6 max-w-[1920px] mx-auto overflow-y-auto">
    <div class="w-full">
        
        <!-- ìƒë‹¨ ì‹œìŠ¤í…œ ê´€ë¦¬ ë°” (Top Management Bar) -->
        <div class="flex justify-between items-center mb-5 bg-white p-5 rounded-2xl border border-slate-200 shadow-sm">
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-4 px-4 py-2 bg-slate-900 text-white rounded-xl shadow-lg">
                    <span class="text-xl">ğŸ›¡ï¸</span>
                    <div>
                        <div class="text-sm text-slate-500 font-bold uppercase leading-none mb-1">ì‹œìŠ¤í…œ ê¶Œí•œ</div>
                        <div class="text-lg font-black tracking-tight" style="color: #0f172a;">ìµœê³  ê¶Œí•œ (ì´ê´„ ê´€ë¦¬)</div>
                    </div>
                </div>
                
                <!-- Oracle DB Status -->
                <div class="flex items-center gap-4 px-5 py-2 bg-emerald-50 border border-emerald-100 rounded-xl">
                    <div class="relative flex h-3 w-3">
                        <span id="db-status-ping" class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span id="db-status-indicator" class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                    </div>
                    <div>
                        <div class="text-sm text-emerald-600 font-bold leading-none mb-1">Oracle DB ê°€ë™ ìƒíƒœ</div>
                        <div id="db-status-text" class="text-base font-black text-emerald-700">ì‹¤ì‹œê°„ ì •ìƒ ì—°ê²° (ê°€ë™ ì¤‘)</div>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-6 select-none">
                <div class="px-6 border-r border-slate-100 text-right">
                    <div class="text-sm text-slate-500 font-bold uppercase mb-1">í˜„ì¬ ì ‘ì† ê³„ì •</div>
                    <div class="text-lg font-black text-blue-600">ë§ˆìŠ¤í„° ê´€ë¦¬ì</div>
                </div>
                <a href="{% url 'super_admin_logout' %}" class="flex items-center gap-3 px-5 py-3 bg-red-50 text-red-500 rounded-xl hover:bg-red-500 hover:text-white transition-all shadow-sm group" title="ì‹œìŠ¤í…œ ë¡œê·¸ì•„ì›ƒ">
                    <span class="font-bold text-base">ë¡œê·¸ì•„ì›ƒ</span>
                    <i class="fa-solid fa-power-off text-xl"></i>
                </a>
            </div>
        </div>

        <section class="animate-fade-in mb-5">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-5 border-b border-gray-700 pb-6 mb-5 mt-5">
                <div>
                    <h1 class="text-3xl font-black text-slate-900 flex items-center gap-4">
                        <span class="p-4 bg-blue-600 rounded-2xl text-white shadow-lg">ğŸ“¡</span>
                        SCM í†µí•© ê´€ì œ ì‹œìŠ¤í…œ
                    </h1>
                    <p class="text-slate-400 mt-4 text-xl font-medium">ì „ì²´ ê°€ë§¹ì  ë¬¼ë¥˜ íë¦„ ë° ì¬ê³  í˜„í™© ì‹¤ì‹œê°„ ê°ì‹œ</p>
                </div>
                <div class="flex gap-4">
                    <!-- ë°ì´í„° ë™ê¸°í™” ë°°ì§€ -->
                    <div class="bg-white px-6 py-4 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4">
                        <div class="w-10 h-10 flex items-center justify-center bg-blue-50 text-blue-600 rounded-full">
                            <i class="fa-solid fa-sync fa-spin"></i>
                        </div>
                        <div>
                            <div class="text-sm text-slate-500 font-bold leading-none mb-1">ë°ì´í„° ë™ê¸°í™”</div>
                            <div class="text-base font-black text-slate-800">ë³¸ì‚¬-ê°€ë§¹ì  ì‹¤ì‹œê°„ ë™ê¸°í™” ì¤‘</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        </div>

        <!-- KPI Row: ERP Style (Spacious & Balanced) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10"> 
            <div class="erp-card p-6 border-l-8 border-l-red-500 shadow-xl transition-transform hover:scale-[1.02]">
                <div class="text-slate-500 text-sm font-black uppercase tracking-widest mb-4">ì¬ê³  ë¶€ì¡± í’ˆëª© í†µí•©</div>
                <div class="flex items-end justify-between">
                    <div class="text-4xl font-black text-slate-900 leading-none">{{ low_stock_count|intcomma }} <span class="text-lg font-bold text-slate-500 ml-1">í’ˆëª©</span></div>
                    <div class="p-3 bg-red-50 rounded-2xl text-red-600 shadow-inner">
                        <i class="fa-solid fa-triangle-exclamation text-2xl"></i>
                    </div>
                </div>
            </div>
            <div class="erp-card p-6 border-l-8 border-l-blue-500 shadow-xl transition-transform hover:scale-[1.02]">
                <div class="text-slate-500 text-sm font-black uppercase tracking-widest mb-4">ì „ì²´ ë¯¸ì²˜ë¦¬ ìˆ˜ì£¼</div>
                <div class="flex items-end justify-between">
                    <div class="text-4xl font-black text-slate-900 leading-none">{{ pending_orders_count|intcomma }} <span class="text-lg font-bold text-slate-500 ml-1">ì£¼ë¬¸</span></div>
                    <div class="p-3 bg-blue-50 rounded-2xl text-blue-600 shadow-inner">
                        <i class="fa-solid fa-clock-rotate-left text-2xl"></i>
                    </div>
                </div>
            </div>
            <div class="erp-card p-6 border-l-8 border-l-indigo-500 shadow-xl transition-transform hover:scale-[1.02]">
                <div class="text-slate-500 text-sm font-black uppercase tracking-widest mb-4">ì´ í™œì„± ê°€ë§¹ì </div>
                <div class="flex items-end justify-between">
                    <div class="text-4xl font-black text-slate-900 leading-none">{{ members|length|intcomma }} <span class="text-lg font-bold text-slate-500 ml-1">ì§€ì </span></div>
                    <div class="p-3 bg-indigo-50 rounded-2xl text-indigo-600 shadow-inner">
                        <i class="fa-solid fa-city text-2xl"></i>
                    </div>
                </div>
            </div>
            <div class="erp-card p-6 border-l-8 border-l-emerald-500 shadow-xl transition-transform hover:scale-[1.02]">
                <div class="text-slate-500 text-sm font-black uppercase tracking-widest mb-4">Oracle DB ì—°ë™ í’ˆì§ˆ</div>
                <div class="flex items-end justify-between">
                    <div id="db-quality-text" class="text-4xl font-black text-emerald-600 leading-none">ìš°ìˆ˜ <span class="text-lg font-bold text-slate-500 ml-1">ë™ê¸°í™”</span></div>
                    <div id="db-quality-icon" class="p-3 bg-emerald-50 rounded-2xl text-emerald-600 shadow-inner">
                        <i class="fa-solid fa-database text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- 1. Incoming Flow (ìœ ì… ë¬¼ë¥˜ ê´€ë¦¬) -->
        <section class="mb-8">
            <div class="erp-section-title text-blue-600 flex items-center gap-3 mb-5">
                <i class="fa-solid fa-arrow-right-to-bracket text-2xl"></i> 
                <span class="text-2xl font-black">ìœ ì… ë¬¼ë¥˜ ê´€ë¦¬</span>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6"> 
                <!-- ê°€ë§¹ì  ìˆ˜ì£¼ ê´€ë¦¬ -->
                <div id="section-salesorder" class="erp-card flex flex-col min-h-[420px] border-t-4 border-t-blue-500 shadow-lg">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-start bg-blue-50/20">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-blue-100 text-blue-600 flex items-center justify-center shadow-sm">
                                <i class="fa-solid fa-file-invoice-dollar text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-black text-slate-800 text-2xl tracking-tight">ê°€ë§¹ì  ìˆ˜ì£¼ ê´€ë¦¬</h3>
                                <div class="mt-2 flex items-center gap-3">
                                    <span class="px-3 py-1 bg-slate-900 text-white text-base font-black rounded-lg shadow-sm border border-slate-700">í…Œì´ë¸”: PLATFORM_UI_ORDER</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-xl border border-slate-200 shadow-xs text-right max-w-[280px]">
                            <div class="text-sm text-slate-500 font-bold mb-1">Oracle DB ìš”ì•½ ì„¤ëª…</div>
                            <div class="text-base text-slate-700 font-medium leading-relaxed">ê°€ë§¹ì ì—ì„œ ìš”ì²­í•œ ì›ë¶€ìì¬ ì£¼ë¬¸ ë‚´ì—­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„° í…Œì´ë¸”</div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-x-auto p-2">
                        <table class="w-full erp-table">
                            <thead>
                                <tr class="bg-slate-50">
                                    <th class="py-4 px-5 text-base font-black text-slate-700">ì£¼ë¬¸ì²˜</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700">í’ˆëª©</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ìˆ˜ëŸ‰</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in pending_orders %}
                                <tr class="group hover:bg-blue-50/50 transition border-b border-slate-50">
                                    <td class="py-4 px-5 font-black text-slate-800 text-base">{{ order.branch_name|default:"ê°€ë§¹ì " }}</td>
                                    <td class="py-4 px-5 text-slate-600 text-base">{{ order.item.item_name }}</td>
                                    <td class="py-4 px-5 text-center font-bold text-slate-900 text-base">{{ order.quantity|intcomma }}ê°œ</td>
                                    <td class="py-4 px-5 text-center text-base">
                                        <div class="flex items-center justify-center gap-2">
                                            <span class="px-3 py-1 bg-amber-100 text-amber-700 font-black rounded-full">ì ‘ìˆ˜ëŒ€ê¸°</span>
                                            <form method="POST" class="inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="order_id" value="{{ order.id }}">
                                                <button type="submit" name="confirm_order" class="bg-blue-600 text-white px-3 py-1 rounded-lg font-black hover:bg-blue-700 shadow-sm transition">ìŠ¹ì¸</button>
                                            </form>
                                            <button onclick="openEditModal('order', '{{ order.id }}', '{{ order.item.item_name }}', '{{ order.quantity }}')" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-blue-50 hover:text-blue-600 flex items-center justify-center transition">
                                                <i class="fa-solid fa-pen-to-square text-sm"></i>
                                            </button>
                                            <form method="POST" class="inline" onsubmit="return confirm('ì´ ìˆ˜ì£¼ ë‚´ì—­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                                {% csrf_token %}
                                                <input type="hidden" name="action_type" value="cancel_item">
                                                <input type="hidden" name="model_type" value="order">
                                                <input type="hidden" name="item_id" value="{{ order.id }}">
                                                <button type="submit" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-rose-50 hover:text-rose-600 flex items-center justify-center transition">
                                                    <i class="fa-solid fa-xmark text-sm"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="py-20 text-center text-slate-400 text-lg font-medium bg-slate-50/30">
                                        ëŒ€ê¸°ì¤‘ì¸ ìˆ˜ì£¼ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ì…ê³  ê´€ë¦¬ (Inbound) -->
                <div id="section-inbound" class="erp-card flex flex-col h-full border-t-4 border-t-indigo-500">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-start bg-indigo-50/20">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-indigo-100 text-indigo-600 flex items-center justify-center shadow-sm">
                                <i class="fa-solid fa-arrow-down-long text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-black text-slate-800 text-2xl tracking-tight">ì›ìì¬ ì…ê³  ê´€ë¦¬</h3>
                                <div class="mt-2 flex items-center gap-3">
                                    <span class="px-3 py-1 bg-slate-900 text-white text-base font-black rounded-lg shadow-sm border border-slate-700">í…Œì´ë¸”: PLATFORM_UI_INBOUND</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-xl border border-slate-200 shadow-xs text-right max-w-[280px]">
                            <div class="text-sm text-slate-400 font-bold mb-1">Oracle DB ìš”ì•½ ì„¤ëª…</div>
                            <div class="text-base text-slate-600 font-medium leading-relaxed">ë‚©í’ˆ ì—…ì²´ë¡œë¶€í„° ì…ê³  ì˜ˆì •ì¸ ìì¬ ë¦¬ìŠ¤íŠ¸ì™€ ê²€ìˆ˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”</div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-x-auto">
                        <table class="w-full erp-table">
                            <thead>
                                <tr>
                                    <th>ì…ê³ ë²ˆí˜¸</th>
                                    <th>ê³µê¸‰ì‚¬</th>
                                    <th>í’ˆëª©</th>
                                    <th>ì˜ˆì •ì¼</th>
                                    <th>ìƒíƒœ</th>
                                    <th class="text-center">ì¡°ì‘</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for log in inbound_logs %}
                                <tr>
                                    <td class="font-mono text-base">IN-{{ log.created_at|date:"ymd" }}-{{ log.id }}</td>
                                    <td class="text-base">{{ log.reason|default:"-"|truncatechars:15 }}</td>
                                    <td class="text-base">{{ log.product.item_name }} ({{ log.quantity }}ea)</td>
                                    <td class="text-base">{{ log.created_at|date:"Y-m-d" }}</td>
                                    <td><span class="badge badge-success text-base text-emerald-600 bg-emerald-50 border border-emerald-100">ì…ê³ ì™„ë£Œ</span></td>
                                    <td class="text-center">
                                        <div class="flex items-center justify-center gap-2">
                                            <button onclick="openEditModal('inbound', '{{ log.id }}', '{{ log.product.item_name }}', '{{ log.quantity }}')" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-blue-50 hover:text-blue-600 flex items-center justify-center transition">
                                                <i class="fa-solid fa-pen-to-square text-sm"></i>
                                            </button>
                                            <form method="POST" class="inline" onsubmit="return confirm('ì´ ì…ê³  ë‚´ì—­ì„ ì‚­ì œ/ì·¨ì†Œí•˜ê³  ì¬ê³ ë¥¼ ì›ë³µí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                                {% csrf_token %}
                                                <input type="hidden" name="action_type" value="cancel_item">
                                                <input type="hidden" name="model_type" value="inbound">
                                                <input type="hidden" name="item_id" value="{{ log.id }}">
                                                <button type="submit" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-rose-50 hover:text-rose-600 flex items-center justify-center transition">
                                                    <i class="fa-solid fa-trash-can text-sm"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="py-20 text-center text-slate-400 text-lg font-medium bg-slate-50/30">
                                        <div class="flex flex-col items-center gap-4">
                                            <i class="fa-solid fa-box-open text-3xl opacity-20"></i>
                                            <span>ìµœê·¼ ì…ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="p-6 bg-slate-50/50 border-t border-slate-100 flex gap-3">
                        <button onclick="openProductRegistrationModal()" class="bg-blue-600 border-2 border-blue-600 py-4 px-6 rounded-xl font-black text-lg hover:bg-blue-700 transition flex-1 shadow-lg shadow-blue-500/20 text-white">
                            <i class="fa-solid fa-plus-circle mr-2"></i>ì‹ ê·œ ìƒí’ˆ ë§ˆìŠ¤í„° ë“±ë¡
                        </button>
                        <button onclick="openGenericModal('inbound')" class="bg-white border-2 border-indigo-500/20 py-4 px-6 rounded-xl font-black text-lg hover:bg-indigo-50 transition flex-1 shadow-sm text-indigo-700">
                            <i class="fa-solid fa-file-import mr-2"></i>ìˆ˜ë™ ì…ê³  ë‚´ì—­ ë“±ë¡
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Outgoing Flow (ìœ ì¶œ ë¬¼ë¥˜ ê´€ë¦¬) -->
        <section class="mb-10">
            <div class="erp-section-title text-rose-600 flex items-center gap-3 mb-5">
                <i class="fa-solid fa-arrow-right-from-bracket text-2xl"></i> 
                <span class="text-2xl font-black">ìœ ì¶œ ë¬¼ë¥˜ ê´€ë¦¬</span>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                <!-- ì‹¤ì‹œê°„ ì¶œê³  ê´€ë¦¬ (ë°°ì†¡ ê´€ë¦¬) -->
                <div id="section-outbound" class="erp-card flex flex-col min-h-[460px] border-t-4 border-t-rose-500 shadow-lg">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-start bg-rose-50/20">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-rose-100 text-rose-600 flex items-center justify-center shadow-sm">
                                <i class="fa-solid fa-truck-fast text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-black text-slate-800 text-2xl tracking-tight">ê°€ë§¹ì  ë°°ì†¡ í˜„í™©</h3>
                                <div class="mt-2 flex items-center gap-3">
                                    <span class="px-3 py-1 bg-slate-900 text-white text-base font-black rounded-lg shadow-sm border border-slate-700">í…Œì´ë¸”: PLATFORM_UI_DELIVERY</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-xl border border-slate-200 shadow-xs text-right max-w-[280px]">
                            <div class="text-sm text-slate-400 font-bold mb-1">Oracle DB ìš”ì•½ ì„¤ëª…</div>
                            <div class="text-base text-slate-600 font-medium leading-relaxed">ë³¸ì‚¬ì—ì„œ ê°€ë§¹ì ìœ¼ë¡œ ì¶œê³ ëœ ë¬¼ë¥˜ì˜ ë°°ì†¡ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ ì¶”ì í•˜ëŠ” í…Œì´ë¸”</div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-x-auto p-2">
                        <table class="w-full erp-table">
                            <thead>
                                <tr class="bg-slate-50">
                                    <th class="py-4 px-5 text-base font-black text-slate-700">ë„ì°©ì§€ì </th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700">ì ì¬í’ˆëª©</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ë‹´ë‹¹ë°°ì†¡ì›</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">í˜„ì¬ìƒíƒœ</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ì¡°ì‘</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for delivery in deliveries %}
                                <tr class="group hover:bg-rose-50/50 transition border-b border-slate-50">
                                    <td class="py-4 px-5 font-black text-slate-800 text-base">{{ delivery.order.branch_name|default:"ê°•ë‚¨ë³¸ì " }}</td>
                                    <td class="py-4 px-5 text-slate-600 text-base">{{ delivery.order.item.item_name }}</td>
                                    <td class="py-4 px-5 text-center font-bold text-slate-700 text-base">{{ delivery.driver_name|default:"í™ê¸¸ë™" }}</td>
                                    <td class="py-4 px-5 text-center text-base">
                                        <div class="flex items-center justify-center gap-2">
                                            <span class="px-3 py-1 rounded-full font-black 
                                                {% if delivery.status == 'DELIVERED' %}bg-emerald-100 text-emerald-700
                                                {% elif delivery.status == 'IN_TRANSIT' %}bg-blue-100 text-blue-700
                                                {% else %}bg-amber-100 text-amber-700{% endif %}">
                                                {{ delivery.get_status_display|default:"ë°°ì†¡ì¤‘" }}
                                            </span>
                                            <button onclick="openEditModal('delivery', '{{ delivery.id }}', '{{ delivery.order.item.item_name }}', '{{ delivery.order.quantity }}')" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-blue-50 hover:text-blue-600 flex items-center justify-center transition">
                                                <i class="fa-solid fa-pen-to-square text-sm"></i>
                                            </button>
                                            <form method="POST" class="inline" onsubmit="return confirm('ì´ ë°°ì†¡ ê±´ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                                {% csrf_token %}
                                                <input type="hidden" name="action_type" value="cancel_item">
                                                <input type="hidden" name="model_type" value="delivery">
                                                <input type="hidden" name="item_id" value="{{ delivery.id }}">
                                                <button type="submit" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-rose-50 hover:text-rose-600 flex items-center justify-center transition">
                                                    <i class="fa-solid fa-xmark text-sm"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="py-20 text-center text-slate-400 text-lg font-medium bg-slate-50/30">
                                        <div class="flex flex-col items-center gap-4">
                                            <i class="fa-solid fa-truck-ramp-box text-3xl opacity-20"></i>
                                            <span>í˜„ì¬ ë°°ì†¡ ì¤‘ì¸ ë¬¼ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ë³¸ì‚¬ ë°œì£¼ ê´€ë¦¬ (Purchase Order) -->
                <div id="section-purchaseorder" class="erp-card flex flex-col min-h-[460px] border-t-4 border-t-amber-500 shadow-lg">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-start bg-amber-50/20">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-amber-100 text-amber-600 flex items-center justify-center shadow-sm">
                                <i class="fa-solid fa-cart-shopping text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-black text-slate-800 text-2xl tracking-tight">ë³¸ì‚¬ ìì¬ ë°œì£¼ ê´€ë¦¬</h3>
                                <div class="mt-2 flex items-center gap-3">
                                    <span class="px-3 py-1 bg-slate-900 text-white text-base font-black rounded-lg shadow-sm border border-slate-700">í…Œì´ë¸”: PLATFORM_UI_ORDER</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-xl border border-slate-200 shadow-xs text-right max-w-[280px]">
                            <div class="text-sm text-slate-400 font-bold mb-1">Oracle DB ìš”ì•½ ì„¤ëª…</div>
                            <div class="text-base text-slate-600 font-medium leading-relaxed">ë³¸ì‚¬ ì¬ê³  ë³´ì¶©ì„ ëª©ì ìœ¼ë¡œ ì™¸ë¶€ í˜‘ë ¥ì—…ì²´ì— ë°œì£¼í•œ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”</div>
                        </div>
                    </div>
                    
                    <!-- AI Recommendation -->
                    <div class="p-5 bg-slate-50/50">
                        <div class="flex items-center gap-5 bg-white p-5 rounded-2xl border border-amber-200/50 shadow-sm">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-400 to-orange-500 text-white flex flex-none items-center justify-center text-2xl shadow-lg">
                                <i class="fa-solid fa-brain"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-black text-amber-600 mb-1 uppercase tracking-tighter">AI ì˜ˆì¸¡ ì—”ì§„ ê¶Œì¥ì‚¬í•­</div>
                                <p class="text-lg text-slate-700 font-bold leading-tight">ë‹­ê³ ê¸°(10í˜¸) <span class="text-rose-600">500ea</span> ì¶”ê°€ ë°œì£¼ê°€ ì‹œê¸‰í•©ë‹ˆë‹¤.</p>
                            </div>
                            <button onclick="openGenericModal('purchase')" class="bg-amber-500 text-white font-black px-6 py-3 rounded-xl hover:bg-amber-600 transition shadow-lg shadow-amber-500/20">ì¦‰ì‹œ ìŠ¹ì¸</button>
                        </div>
                    </div>

                    <div class="flex-1 overflow-x-auto p-2">
                        <table class="w-full erp-table">
                            <thead>
                                <tr class="bg-slate-50">
                                    <th class="py-4 px-5 text-base font-black text-slate-700">ë°œì£¼ì½”ë“œ</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700">í’ˆëª©ëª…</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ë°œì£¼ìˆ˜ëŸ‰</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ìŠ¹ì¸ìƒíƒœ</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ì¡°ì‘</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for po in purchase_orders %}
                                <tr class="group hover:bg-amber-50/50 transition border-b border-slate-50">
                                    <td class="py-4 px-5 font-bold text-slate-400 text-base">PO-{{ po.id|default:"1001" }}</td>
                                    <td class="py-4 px-5 font-black text-slate-800 text-base">{{ po.item.item_name|default:"í’ˆëª©" }}</td>
                                    <td class="py-4 px-5 text-center font-bold text-slate-900 text-base">{{ po.quantity|intcomma }}ê°œ</td>
                                    <td class="py-4 px-5 text-center text-base">
                                        <div class="flex items-center justify-center gap-2">
                                            <span class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 font-black">ìŠ¹ì¸ì™„ë£Œ</span>
                                            <button onclick="openEditModal('order', '{{ po.id }}', '{{ po.item.item_name }}', '{{ po.quantity }}')" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-blue-50 hover:text-blue-600 flex items-center justify-center transition">
                                                <i class="fa-solid fa-pen-to-square text-sm"></i>
                                            </button>
                                            <form method="POST" class="inline" onsubmit="return confirm('ì´ ë°œì£¼ ë‚´ì—­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                                {% csrf_token %}
                                                <input type="hidden" name="action_type" value="cancel_item">
                                                <input type="hidden" name="model_type" value="order">
                                                <input type="hidden" name="item_id" value="{{ po.id }}">
                                                <button type="submit" class="w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-rose-50 hover:text-rose-600 flex items-center justify-center transition">
                                                    <i class="fa-solid fa-xmark text-sm"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="py-20 text-center text-slate-400 text-lg font-medium bg-slate-50/30">
                                        ë°œì£¼ ë‚´ì—­ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="p-6 bg-slate-50/50 border-t border-slate-100">
                        <button onclick="openGenericModal('purchase')" class="bg-white text-slate-800 border-2 border-amber-500/20 py-4 px-6 rounded-xl font-black text-lg hover:bg-amber-50 transition w-full shadow-sm text-amber-700">
                            <i class="fa-solid fa-file-signature mr-2"></i>ì‹ ê·œ ì™¸ë¶€ ë°œì£¼ ì‘ì„±
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Global Inventory & Members -->
        <section class="mb-10">
            <div class="erp-section-title text-slate-700 flex items-center gap-3 mb-5">
                <i class="fa-solid fa-layer-group text-2xl"></i> 
                <span class="text-2xl font-black">ì „ì²´ SCM ìì› í†µí•© í˜„í™©</span>
            </div>
            
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6"> 
                 <!-- í†µí•© ì¬ê³  í˜„í™© -->
                <div class="xl:col-span-2 erp-card shadow-xl flex flex-col min-h-[500px]">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/30">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-slate-200 text-slate-600 flex items-center justify-center shadow-sm">
                                <i class="fa-solid fa-warehouse text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-black text-slate-800 text-2xl tracking-tight">ë³¸ì‚¬ í†µí•© ì„¼í„° ì¬ê³  í˜„í™©</h3>
                                <div class="mt-2 flex items-center gap-3">
                                    <span class="px-3 py-1 bg-slate-900 text-white text-base font-black rounded-lg shadow-sm border border-slate-700">í…Œì´ë¸”: PLATFORM_UI_INVENTORY</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <div class="relative">
                                <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" id="global-search-input" onkeyup="filterSCMTables()" placeholder="ìì¬ ì½”ë“œ/ëª… ê²€ìƒ‰..." class="pl-12 pr-6 py-3 text-base border-2 border-slate-100 rounded-2xl bg-white focus:border-blue-500 outline-none w-[280px] transition-all">
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-x-auto p-2">
                        <table class="w-full erp-table">
                            <thead>
                                <tr class="bg-slate-50">
                                    <th class="py-4 px-5 text-base font-black text-slate-700">ìì¬ ì •ë³´ (SKU)</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">í˜„ì¬ê³ </th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ì ì •ì¬ê³ </th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ìˆ˜ê¸‰ìƒíƒœ</th>
                                    <th class="py-4 px-5 text-base font-black text-slate-700 text-center">ì¬ê³ ì¡°ì •</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in inventory_items %}
                                <tr class="group hover:bg-slate-50 transition border-b border-slate-50">
                                    <td class="py-4 px-5">
                                        <div class="font-black text-slate-800 text-base">{{ item.item_name }}</div>
                                        <div class="text-sm text-slate-400 font-bold mt-1">CODE: {{ item.id }}</div>
                                    </td>
                                    <td class="py-4 px-5 text-center">
                                        <span class="inline-block px-4 py-1.5 bg-slate-900 text-white font-black rounded-lg text-base shadow-sm">
                                            {{ item.current_stock|intcomma }}
                                        </span>
                                    </td>
                                    <td class="py-4 px-5 text-center font-bold text-slate-400 text-base">{{ item.optimal_stock|intcomma }}</td>
                                    <td class="py-4 px-5 text-center">
                                        {% if item.status == 'GOOD' %}
                                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 font-black rounded-full text-base">ì•ˆì •</span>
                                        {% elif item.status == 'LOW' %}
                                        <span class="px-3 py-1 bg-rose-100 text-rose-700 font-black rounded-full text-base">ë¶€ì¡±</span>
                                        {% else %}
                                        <span class="px-3 py-1 bg-amber-100 text-amber-700 font-black rounded-full text-base">ê³¼ë‹¤</span>
                                        {% endif %}
                                    </td>
                                    <td class="py-4 px-5 text-center">
                                        <button onclick="openInventoryModal('{{ item.id|escapejs }}', '{{ item.item_name|escapejs }}', '{{ item.current_stock|escapejs }}')" class="w-10 h-10 flex items-center justify-center mx-auto text-slate-400 hover:text-blue-600 transition bg-slate-100 rounded-xl hover:bg-blue-50">
                                            <i class="fa-solid fa-sliders"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Right Side: Members & Logs -->
                <div class="flex flex-col gap-6">
                    <!-- Members List -->
                    <div class="erp-card shadow-lg flex flex-col h-[380px]">
                        <div class="p-5 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                            <h3 class="font-black text-xl text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-store text-blue-500"></i> ê°€ë§¹ì  ë§ˆìŠ¤í„° ê´€ë¦¬
                            </h3>
                            <span class="text-sm font-black bg-blue-100 text-blue-700 px-3 py-1 rounded-lg">ì „ì²´: {{ members|length }}ê°œ</span>
                        </div>
                        <div class="p-5 flex-1 flex flex-col">
                            <form method="POST" class="mb-4 flex gap-2">
                                {% csrf_token %}
                                <input type="text" name="name" placeholder="ì‹ ê·œ ê°€ë§¹ì ëª…" class="erp-input flex-1 px-4 py-3 text-base border-2" required>
                                <button type="submit" name="add_member" class="bg-slate-900 hover:bg-blue-600 text-white px-5 rounded-2xl transition shadow-lg">
                                    <i class="fa-solid fa-plus text-lg"></i>
                                </button>
                            </form>
                            <div class="flex-1 overflow-y-auto pr-1 space-y-3 custom-scrollbar">
                                {% for member in members %}
                                <div class="p-4 rounded-2xl border border-slate-100 bg-white flex items-center justify-between group hover:border-blue-500/30 hover:shadow-md transition">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 rounded-xl bg-slate-50 border border-slate-100 flex items-center justify-center font-black text-blue-600 text-lg shadow-inner">
                                            {{ member.name|slice:":1" }}
                                        </div>
                                        <div>
                                            <div class="font-black text-slate-800 text-base leading-none mb-1">{{ member.name }}</div>
                                            <div class="text-sm text-slate-400 font-bold uppercase tracking-widest">KEY: {{ member.master_key }}</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <form method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="member_id" value="{{ member.id }}">
                                            <button type="submit" name="delete_member" class="w-10 h-10 rounded-xl text-slate-300 hover:bg-rose-50 hover:text-rose-500 flex items-center justify-center transition">
                                                <i class="fa-solid fa-trash-can text-base"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- System Logs Console -->
                    <div class="erp-card bg-[#0f172a] border-[#1e293b] text-slate-400 shadow-2xl flex flex-col flex-1 min-h-[260px]">
                        <div class="px-5 py-4 border-b border-[#1e293b] flex justify-between items-center bg-[#1e293b]/30">
                            <h4 class="font-black text-sm uppercase tracking-[0.15em] text-blue-500 whitespace-nowrap">ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ì½˜ì†”</h4>
                            <div class="flex items-center gap-3">
                                <span class="text-xs font-bold text-slate-500 whitespace-nowrap">ì˜¤ë¼í´ DB ë™ê¸°í™”: í™œì„±í™”</span>
                                <span class="w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.5)]"></span>
                            </div>
                        </div>
                        <div class="p-5 text-sm font-mono space-y-3 flex-1 overflow-y-auto custom-scrollbar-dark leading-relaxed">
                            <div class="flex gap-4"><span class="text-slate-400 shrink-0 font-bold" style="color: #94a3b8 !important;">[10:42:51]</span> <span class="text-blue-400 font-bold shrink-0" style="color: #60a5fa !important;">ì •ë³´</span> <span style="color: #ffffff !important;">Oracle DB ìŠ¤ëƒ…ìƒ· ìƒì„± ì™„ë£Œ (ID: snp_240204)</span></div>
                            <div class="flex gap-4"><span class="text-slate-400 shrink-0 font-bold" style="color: #94a3b8 !important;">[10:45:12]</span> <span class="text-emerald-400 font-bold shrink-0" style="color: #34d399 !important;">ì„±ê³µ</span> <span style="color: #ffffff !important;">ì‹ ê·œ ìˆ˜ì£¼ ì²˜ë¦¬ ì™„ë£Œ (ID: GANGNAM_01)</span></div>
                            <div class="flex gap-4"><span class="text-slate-400 shrink-0 font-bold" style="color: #94a3b8 !important;">[10:51:33]</span> <span class="text-blue-400 font-bold shrink-0" style="color: #60a5fa !important;">ì •ë³´</span> <span style="color: #ffffff !important;">124ê°œ í’ˆëª© ì¬ê³  ëŒ€ì¡° ì™„ë£Œ</span></div>
                            <div class="flex gap-4"><span class="text-slate-400 shrink-0 font-bold" style="color: #94a3b8 !important;">[11:00:05]</span> <span class="text-rose-400 font-bold shrink-0" style="color: #fb7185 !important;">ê²½ê³ </span> <span class="text-rose-300 font-bold" style="color: #fda4af !important;">ì¬ê³  ë¶€ì¡±: ì–‘íŒŒ (20kg) - ë³´ì¶© ê¶Œì¥</span></div>
                            <div class="flex gap-4"><span class="text-slate-400 shrink-0 font-bold" style="color: #94a3b8 !important;">[11:15:42]</span> <span class="text-slate-400 font-bold shrink-0" style="color: #94a3b8 !important;">ë””ë²„ê·¸</span> <span style="color: #94a3b8 !important;">ì‹œìŠ¤í…œ ì •ìƒ ê°€ë™ ì¤‘</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>
</main>

<!-- Inventory Update Modal -->
<div id="inventoryModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden items-center justify-center opacity-0 transition-opacity duration-300">
    <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-2xl transform scale-95 transition-transform duration-300" id="invModalContent">
        <h3 class="text-xl font-extrabold text-slate-900 mb-2">ì¬ê³  ì¡°ì •</h3>
        <p class="text-sm text-slate-500 mb-6" id="invModalItemName">í’ˆëª©: -</p>
        
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="update_inventory" value="true">
            <input type="hidden" name="item_id" id="invModalItemId">
            
            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">ë³€ê²½í•  ì‹¤ì¬ê³  ìˆ˜ëŸ‰ (Update Quantity)</label>
            <input type="number" name="current_stock" id="invModalStock" class="erp-input mb-6 font-mono font-bold text-lg" required>
            
            <div class="flex gap-3">
                <button type="button" onclick="closeInventoryModal()" class="flex-1 py-3 bg-slate-100 hover:bg-slate-200 text-slate-800 rounded-xl font-black transition">ì·¨ì†Œ</button>
                <button type="submit" class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition shadow-lg shadow-blue-500/20">ë³€ê²½ ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

    </div>
</div>

<!-- Product Registration Modal -->
<div id="productRegistrationModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden items-center justify-center opacity-0 transition-opacity duration-300">
    <div class="bg-white w-full max-w-lg p-8 rounded-2xl shadow-2xl transform scale-95 transition-transform duration-300" id="productModalContent">
        <div class="flex items-center gap-4 mb-6">
            <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center text-xl">
                <i class="fa-solid fa-box-open"></i>
            </div>
            <div>
                <h3 class="text-2xl font-black text-slate-900">ì‹ ê·œ ìƒí’ˆ ë“±ë¡</h3>
                <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Master Product Registration</p>
            </div>
        </div>
        
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="action_type" value="reg_product">
            
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-black text-slate-500 mb-2">ìƒí’ˆ ëª…ì¹­ (Item Name)</label>
                    <input type="text" name="item_name" class="erp-input w-full font-bold" placeholder="ì˜ˆ: ë‹­ê³ ê¸°(12í˜¸)" required>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-black text-slate-500 mb-2">ì´ˆê¸° ì¬ê³  (Initial Stock)</label>
                        <input type="number" name="current_stock" class="erp-input w-full font-mono font-bold" value="0" required>
                    </div>
                    <div>
                        <label class="block text-sm font-black text-slate-500 mb-2">ì ì • ì¬ê³  (Optimal Stock)</label>
                        <input type="number" name="optimal_stock" class="erp-input w-full font-mono font-bold" value="100" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-black text-slate-500 mb-2">ì¹´í…Œê³ ë¦¬ (Category)</label>
                    <input type="text" name="category" class="erp-input w-full font-bold" value="General">
                </div>

                <div class="p-4 bg-amber-50 border border-amber-100 rounded-xl flex items-center gap-3">
                    <i class="fa-solid fa-circle-info text-amber-500 text-xl"></i>
                    <p class="text-sm text-amber-800 font-medium leading-tight">ë“±ë¡ ì‹œ í†µí•© ì¬ê³  ë§ˆìŠ¤í„° ë° ì¶œê³  ëŒ€ê¸° ëª©ë¡ì— ì¦‰ì‹œ ì¶”ê°€ë©ë‹ˆë‹¤.</p>
                </div>
            </div>
            
            <div class="flex gap-3 mt-8">
                <button type="button" onclick="closeProductRegistrationModal()" class="flex-1 py-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-black transition">ë‹«ê¸°</button>
                <button type="submit" class="flex-1 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-black transition shadow-lg shadow-blue-500/20">ìƒí’ˆ ë§ˆìŠ¤í„° ìƒì„±</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openGenericModal(type) {
        const modal = document.getElementById('genericLogisticsModal');
        const content = document.getElementById('logisticModalContent');
        const title = document.getElementById('logTitle');
        const subtitle = document.getElementById('logSubtitle');
        const actionType = document.getElementById('logActionType');

        if(type === 'inbound') {
            title.innerText = 'ì‹ ê·œ ì…ê³  ë“±ë¡';
            subtitle.innerText = 'ë³¸ì‚¬ ì°½ê³ ë¡œ ë“¤ì–´ì˜¤ëŠ” ë¬¼ëŸ‰ì„ ë“±ë¡í•©ë‹ˆë‹¤.';
            actionType.value = 'reg_inbound';
        } else if(type === 'purchase') {
            title.innerText = 'ê³µê¸‰ì‚¬ ë°œì£¼ ë“±ë¡';
            subtitle.innerText = 'ì™¸ë¶€ ê³µê¸‰ì—…ì²´ì— ìì¬ êµ¬ë§¤ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.';
            actionType.value = 'reg_procure';
        }

        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.classList.add('flex');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }, 10);
    }

    function closeGenericModal() {
        const modal = document.getElementById('genericLogisticsModal');
        const content = document.getElementById('logisticModalContent');
        
        modal.classList.add('opacity-0');
        content.classList.remove('scale-100');
        content.classList.add('scale-95');
        
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 300);
    }

    function openInventoryModal(id, name, stock) {
        const modal = document.getElementById('inventoryModal');
        const content = document.getElementById('invModalContent');
        
        document.getElementById('invModalItemId').value = id;
        document.getElementById('invModalItemName').innerText = `í’ˆëª©: ${name}`;
        document.getElementById('invModalStock').value = stock;
        
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.classList.add('flex');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }, 10);
    }

    function closeInventoryModal() {
        const modal = document.getElementById('inventoryModal');
        const content = document.getElementById('invModalContent');
        
        modal.classList.add('opacity-0');
        content.classList.remove('scale-100');
        content.classList.add('scale-95');
        
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 300);
    }

    function openEditModal(model, id, name, qty) {
        const modal = document.getElementById('logisticsEditModal');
        const content = document.getElementById('logEditModalContent');
        
        document.getElementById('logEditModelType').value = model;
        document.getElementById('logEditItemId').value = id;
        document.getElementById('logEditModalSub').innerText = `í’ˆëª©: ${name}`;
        document.getElementById('logEditValue').value = qty;
        
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.classList.add('flex');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }, 10);
    }

    function closeEditModal() {
        const modal = document.getElementById('logisticsEditModal');
        const content = document.getElementById('logEditModalContent');
        
        modal.classList.add('opacity-0');
        content.classList.remove('scale-100');
        content.classList.add('scale-95');
        
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 300);
    }

    function openProductRegistrationModal() {
        const modal = document.getElementById('productRegistrationModal');
        const content = document.getElementById('productModalContent');
        
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.classList.add('flex');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }, 10);
    }

    function closeProductRegistrationModal() {
        const modal = document.getElementById('productRegistrationModal');
        const content = document.getElementById('productModalContent');
        
        modal.classList.add('opacity-0');
        content.classList.remove('scale-100');
        content.classList.add('scale-95');
        
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 300);
    }

    function filterSCMTables() {
        const input = document.getElementById('global-search-input');
        const filter = input.value.toLowerCase();
        
        // Target all tables in the dashboard
        const tables = document.querySelectorAll('.erp-table');
        
        tables.forEach(table => {
            const tr = table.getElementsByTagName('tr');
            for (let i = 1; i < tr.length; i++) {
                let rowText = tr[i].textContent || tr[i].innerText;
                if (rowText.toLowerCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        });
    }
</script>
    
    <script>
        // Real-time System Status Update
        async function updateSystemStatus() {
            try {
                const response = await fetch('/api/system-status/');
                const data = await response.json();
                
                const dbIndicator = document.getElementById('db-status-indicator');
                const dbPing = document.getElementById('db-status-ping');
                const dbText = document.getElementById('db-status-text');
                const dbStatusContainer = document.getElementById('db-status-container');
                // dbQuality and dbQualityIcon are not present in the current HTML structure,
                // so we will only update the elements that exist.
                // const dbQuality = document.getElementById('db-quality-text');
                // const dbQualityIcon = document.getElementById('db-quality-icon');
                
                if (data.db_running) {
                    if (dbPing) dbPing.className = 'animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75';
                    if (dbIndicator) dbIndicator.className = 'relative inline-flex rounded-full h-3 w-3 bg-emerald-500';
                    if (dbText) dbText.innerText = 'ì‹¤ì‹œê°„ ì •ìƒ ì—°ê²° (ê°€ë™ ì¤‘)';
                    if (dbText) dbText.className = 'text-sm font-bold text-emerald-800 whitespace-nowrap';
                    if (dbStatusContainer) dbStatusContainer.className = 'flex items-center gap-4 px-5 py-2 bg-emerald-50 border border-emerald-100 rounded-xl';
                    
                    // if(dbQuality) dbQuality.innerText = 'ìš°ìˆ˜';
                    // if(dbQuality) dbQuality.className = 'text-4xl font-black text-emerald-600 leading-none';
                } else {
                    if (dbPing) dbPing.className = 'absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75';
                    if (dbIndicator) dbIndicator.className = 'relative inline-flex rounded-full h-3 w-3 bg-red-500';
                    if (dbText) dbText.innerText = 'ì—°ê²° ëŠê¹€ (ì ê²€ í•„ìš”)';
                    if (dbText) dbText.className = 'text-sm font-bold text-red-800 whitespace-nowrap';
                    if (dbStatusContainer) dbStatusContainer.className = 'flex items-center gap-4 px-5 py-2 bg-red-50 border border-red-100 rounded-xl';
                    
                    // if(dbQuality) dbQuality.innerText = 'ì˜¤ë¥˜';
                    // if(dbQuality) dbQuality.className = 'text-4xl font-black text-red-600 leading-none';
                }
            } catch (error) {
                console.error('System status check failed:', error);
                // Optionally update UI to show error state
                const dbIndicator = document.getElementById('db-status-indicator');
                const dbPing = document.getElementById('db-status-ping');
                const dbText = document.getElementById('db-status-text');
                const dbStatusContainer = document.getElementById('db-status-container');

                if (dbPing) dbPing.className = 'absolute inline-flex h-full w-full rounded-full bg-gray-400 opacity-75';
                if (dbIndicator) dbIndicator.className = 'relative inline-flex rounded-full h-3 w-3 bg-gray-500';
                if (dbText) dbText.innerText = 'ìƒíƒœ í™•ì¸ ë¶ˆê°€ (API ì˜¤ë¥˜)';
                if (dbText) dbText.className = 'text-sm font-bold text-gray-800 whitespace-nowrap';
                if (dbStatusContainer) dbStatusContainer.className = 'flex items-center gap-4 px-5 py-2 bg-gray-50 border border-gray-100 rounded-xl';
            }
        }
        
        setInterval(updateSystemStatus, 5000);
        updateSystemStatus(); // Call immediately on page load
    </script>
{% endblock %}